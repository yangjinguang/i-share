"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var user_api_1 = require("./apis/user-api");
App({
    globalData: {},
    onLaunch: function () {
        var _this = this;
        wx.checkSession({
            success: function () {
                if (!_this.globalData.isLogin) {
                    var userApi = new user_api_1.UserApi();
                    userApi.profile().then(function (profile) {
                        profile.isAdmin = profile.roles.indexOf(2) > -1;
                        profile.isTeacher = profile.roles.indexOf(3) > -1;
                        _this.globalData.isLogin = true;
                        _this.globalData.profile = profile;
                        if (_this.profileReadyCallback) {
                            _this.profileReadyCallback(profile);
                        }
                    }).catch(function () {
                        wx.removeStorageSync('accessToken');
                        wx.switchTab({
                            url: '/pages/my/my'
                        });
                    });
                }
            },
            fail: function () {
                wx.removeStorageSync('accessToken');
                wx.switchTab({
                    url: '/pages/my/my'
                });
            }
        });
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXBwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBRUEsNENBQXdDO0FBY3hDLEdBQUcsQ0FBUztJQUNSLFVBQVUsRUFBRSxFQUFFO0lBQ2QsUUFBUTtRQUFSLGlCQThCQztRQTdCRyxFQUFFLENBQUMsWUFBWSxDQUFDO1lBQ1osT0FBTyxFQUFFO2dCQUVMLElBQUksQ0FBQyxLQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRTtvQkFDMUIsSUFBSSxPQUFPLEdBQUcsSUFBSSxrQkFBTyxFQUFFLENBQUM7b0JBQzVCLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBQSxPQUFPO3dCQUMxQixPQUFPLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUNoRCxPQUFPLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3dCQUNsRCxLQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7d0JBQy9CLEtBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQzt3QkFDbEMsSUFBSSxLQUFJLENBQUMsb0JBQW9CLEVBQUU7NEJBQzNCLEtBQUksQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsQ0FBQzt5QkFDdEM7b0JBQ0wsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO3dCQUNMLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLENBQUMsQ0FBQzt3QkFDcEMsRUFBRSxDQUFDLFNBQVMsQ0FBQzs0QkFDVCxHQUFHLEVBQUUsY0FBYzt5QkFDdEIsQ0FBQyxDQUFDO29CQUNQLENBQUMsQ0FBQyxDQUFDO2lCQUNOO1lBQ0wsQ0FBQztZQUNELElBQUksRUFBRTtnQkFFRixFQUFFLENBQUMsaUJBQWlCLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBQ3BDLEVBQUUsQ0FBQyxTQUFTLENBQUM7b0JBQ1QsR0FBRyxFQUFFLGNBQWM7aUJBQ3RCLENBQUMsQ0FBQztZQUNQLENBQUM7U0FDSixDQUFDLENBQUM7SUFDUCxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gYXBwLnRzXG5pbXBvcnQge1VzZXJ9IGZyb20gJy4vdXRpbHMvdHlwZXMvdXNlcic7XG5pbXBvcnQge1VzZXJBcGl9IGZyb20gJy4vYXBpcy91c2VyLWFwaSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSU15QXBwIHtcbiAgICB1c2VySW5mb1JlYWR5Q2FsbGJhY2s/KHJlczogYW55KTogdm9pZFxuXG4gICAgcHJvZmlsZVJlYWR5Q2FsbGJhY2s/KHJlcz86IFVzZXIpOiB2b2lkXG5cbiAgICBnbG9iYWxEYXRhOiB7XG4gICAgICAgIHByb2ZpbGU/OiBVc2VyO1xuICAgICAgICBpc0xvZ2luPzogYm9vbGVhbjtcbiAgICB9XG59XG5cblxuQXBwPElNeUFwcD4oe1xuICAgIGdsb2JhbERhdGE6IHt9LFxuICAgIG9uTGF1bmNoKCkge1xuICAgICAgICB3eC5jaGVja1Nlc3Npb24oe1xuICAgICAgICAgICAgc3VjY2VzczogKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vc2Vzc2lvbl9rZXkg5pyq6L+H5pyf77yM5bm25LiU5Zyo5pys55Sf5ZG95ZGo5pyf5LiA55u05pyJ5pWIXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLmdsb2JhbERhdGEuaXNMb2dpbikge1xuICAgICAgICAgICAgICAgICAgICBsZXQgdXNlckFwaSA9IG5ldyBVc2VyQXBpKCk7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJBcGkucHJvZmlsZSgpLnRoZW4ocHJvZmlsZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9maWxlLmlzQWRtaW4gPSBwcm9maWxlLnJvbGVzLmluZGV4T2YoMikgPiAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2ZpbGUuaXNUZWFjaGVyID0gcHJvZmlsZS5yb2xlcy5pbmRleE9mKDMpID4gLTE7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEuaXNMb2dpbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdsb2JhbERhdGEucHJvZmlsZSA9IHByb2ZpbGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wcm9maWxlUmVhZHlDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJvZmlsZVJlYWR5Q2FsbGJhY2socHJvZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHd4LnJlbW92ZVN0b3JhZ2VTeW5jKCdhY2Nlc3NUb2tlbicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgd3guc3dpdGNoVGFiKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICcvcGFnZXMvbXkvbXknXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZhaWw6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAvLyBzZXNzaW9uX2tleSDlt7Lnu4/lpLHmlYjvvIzpnIDopoHph43mlrDmiafooYznmbvlvZXmtYHnqItcbiAgICAgICAgICAgICAgICB3eC5yZW1vdmVTdG9yYWdlU3luYygnYWNjZXNzVG9rZW4nKTtcbiAgICAgICAgICAgICAgICB3eC5zd2l0Y2hUYWIoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvcGFnZXMvbXkvbXknXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG59KTtcbiJdfQ==