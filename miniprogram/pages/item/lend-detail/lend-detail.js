"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var item_api_1 = require("../../../apis/item-api");
var item_lend_order_1 = require("../../../utils/types/item-lend-order");
var utils_1 = require("../../../utils/utils");
Page({
    data: {
        itemApi: {},
        orderId: 0,
        itemLendOrder: {},
        isAgree: true,
        from: 1,
    },
    onLoad: function (query) {
        this.setData({
            itemApi: new item_api_1.ItemApi(),
            orderId: query.id ? Number(query.id) : 0,
            from: query.from ? Number(query.from) : 1,
        });
    },
    onShow: function () {
        this.getDetail();
    },
    getDetail: function () {
        var _this = this;
        if (this.data.orderId) {
            this.data.itemApi.getLendDetail(this.data.orderId).then(function (result) {
                result.createdAtView = result.createdAt ? utils_1.Utils.dateFormat(new Date(result.createdAt), 'yyyy-MM-dd hh:mm:ss') : '';
                result.statusView = result.status ? item_lend_order_1.ItemLoanedRecordArr[result.status] : '';
                _this.setData({
                    itemLendOrder: result
                });
            });
        }
    },
    agreeChange: function (e) {
        this.setData({
            isAgree: e.detail.value == 'true'
        });
        console.log(this.data);
    },
    formSubmit: function () {
        var body = {
            orderId: this.data.orderId,
            agree: this.data.isAgree,
        };
        this.data.itemApi.lendOrderHandle(body).then(function () {
            wx.navigateBack({
                delta: 1
            });
        });
    },
    lendReturn: function () {
        var _this = this;
        wx.showModal({
            title: '确定要归还此图书?',
            content: '',
            confirmText: '确定',
            cancelText: '取消',
            success: function (res) {
                if (res.confirm) {
                    _this.data.itemApi.lendReturn(_this.data.itemLendOrder.id).then(function () {
                        _this.getDetail();
                    });
                }
                else {
                }
            }
        });
    },
    lendCancel: function () {
        var _this = this;
        wx.showModal({
            title: '确定撤回此次借阅?',
            content: '',
            confirmText: '确定',
            cancelText: '取消',
            success: function (res) {
                if (res.confirm) {
                    _this.data.itemApi.lendCancel(_this.data.itemLendOrder.id).then(function () {
                        _this.getDetail();
                    });
                }
                else {
                }
            }
        });
    },
    lendDelete: function () {
        var _this = this;
        wx.showModal({
            title: '确定要删除此申请?',
            content: '删除后不可恢复',
            confirmText: '确定',
            cancelText: '取消',
            success: function (res) {
                if (res.confirm) {
                    _this.data.itemApi.lendDelete(_this.data.itemLendOrder.id).then(function () {
                        wx.navigateBack({
                            delta: 1
                        });
                    });
                }
                else {
                }
            }
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGVuZC1kZXRhaWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJsZW5kLWRldGFpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1EQUErQztBQUMvQyx3RUFBd0Y7QUFFeEYsOENBQTJDO0FBRTNDLElBQUksQ0FBQztJQUNELElBQUksRUFBRTtRQUNGLE9BQU8sRUFBVyxFQUFFO1FBQ3BCLE9BQU8sRUFBRSxDQUFDO1FBQ1YsYUFBYSxFQUFpQixFQUFFO1FBQ2hDLE9BQU8sRUFBRSxJQUFJO1FBQ2IsSUFBSSxFQUFFLENBQUM7S0FDVjtJQUNELE1BQU0sWUFBQyxLQUFVO1FBQ2IsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNULE9BQU8sRUFBRSxJQUFJLGtCQUFPLEVBQUU7WUFDdEIsT0FBTyxFQUFFLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDeEMsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDNUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNELE1BQU07UUFDRixJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDckIsQ0FBQztJQUNELFNBQVM7UUFBVCxpQkFVQztRQVRHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDbkIsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUEsTUFBTTtnQkFDMUQsTUFBTSxDQUFDLGFBQWEsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxhQUFLLENBQUMsVUFBVSxDQUFDLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENB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RUFBRSxDQUFDLFlBQVksQ0FBQzs0QkFDWixLQUFLLEVBQUUsQ0FBQzt5QkFDWCxDQUFDLENBQUM7b0JBQ1AsQ0FBQyxDQUFDLENBQUM7aUJBQ047cUJBQU07aUJBQ047WUFDTCxDQUFDO1NBQ0osQ0FBQyxDQUFDO0lBQ1AsQ0FBQztDQUNKLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SXRlbUFwaX0gZnJvbSAnLi4vLi4vLi4vYXBpcy9pdGVtLWFwaSc7XG5pbXBvcnQge0l0ZW1MZW5kT3JkZXIsIEl0ZW1Mb2FuZWRSZWNvcmRBcnJ9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3R5cGVzL2l0ZW0tbGVuZC1vcmRlcic7XG5pbXBvcnQge0xlbmRPcmRlckhhbmRsZUJvZHl9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3R5cGVzL2xlbmQtb3JkZXItaGFuZGxlLWJvZHknO1xuaW1wb3J0IHtVdGlsc30gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdXRpbHMnO1xuXG5QYWdlKHtcbiAgICBkYXRhOiB7XG4gICAgICAgIGl0ZW1BcGk6IDxJdGVtQXBpPnt9LFxuICAgICAgICBvcmRlcklkOiAwLFxuICAgICAgICBpdGVtTGVuZE9yZGVyOiA8SXRlbUxlbmRPcmRlcj57fSxcbiAgICAgICAgaXNBZ3JlZTogdHJ1ZSxcbiAgICAgICAgZnJvbTogMSxcbiAgICB9LFxuICAgIG9uTG9hZChxdWVyeTogYW55KSB7XG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICBpdGVtQXBpOiBuZXcgSXRlbUFwaSgpLFxuICAgICAgICAgICAgb3JkZXJJZDogcXVlcnkuaWQgPyBOdW1iZXIocXVlcnkuaWQpIDogMCxcbiAgICAgICAgICAgIGZyb206IHF1ZXJ5LmZyb20gPyBOdW1iZXIocXVlcnkuZnJvbSkgOiAxLFxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIG9uU2hvdygpIHtcbiAgICAgICAgdGhpcy5nZXREZXRhaWwoKTtcbiAgICB9LFxuICAgIGdldERldGFpbCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS5vcmRlcklkKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGEuaXRlbUFwaS5nZXRMZW5kRGV0YWlsKHRoaXMuZGF0YS5vcmRlcklkKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmNyZWF0ZWRBdFZpZXcgPSByZXN1bHQuY3JlYXRlZEF0ID8gVXRpbHMuZGF0ZUZvcm1hdChuZXcgRGF0ZShyZXN1bHQuY3JlYXRlZEF0KSwgJ3l5eXktTU0tZGQgaGg6bW06c3MnKSA6ICcnO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5zdGF0dXNWaWV3ID0gcmVzdWx0LnN0YXR1cyA/IEl0ZW1Mb2FuZWRSZWNvcmRBcnJbcmVzdWx0LnN0YXR1c10gOiAnJztcbiAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgICAgICAgICBpdGVtTGVuZE9yZGVyOiByZXN1bHRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBhZ3JlZUNoYW5nZShlOiBhbnkpIHtcbiAgICAgICAgdGhpcy5zZXREYXRhISh7XG4gICAgICAgICAgICBpc0FncmVlOiBlLmRldGFpbC52YWx1ZSA9PSAndHJ1ZSdcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZGF0YSk7XG4gICAgfSxcbiAgICBmb3JtU3VibWl0KCkge1xuICAgICAgICBsZXQgYm9keSA9IDxMZW5kT3JkZXJIYW5kbGVCb2R5PntcbiAgICAgICAgICAgIG9yZGVySWQ6IHRoaXMuZGF0YS5vcmRlcklkLFxuICAgICAgICAgICAgYWdyZWU6IHRoaXMuZGF0YS5pc0FncmVlLFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmRhdGEuaXRlbUFwaS5sZW5kT3JkZXJIYW5kbGUoYm9keSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB3eC5uYXZpZ2F0ZUJhY2soe1xuICAgICAgICAgICAgICAgIGRlbHRhOiAxXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBsZW5kUmV0dXJuKCkge1xuICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgICAgdGl0bGU6ICfnoa7lrpropoHlvZLov5jmraTlm77kuaY/JyxcbiAgICAgICAgICAgIGNvbnRlbnQ6ICcnLFxuICAgICAgICAgICAgY29uZmlybVRleHQ6ICfnoa7lrponLFxuICAgICAgICAgICAgY2FuY2VsVGV4dDogJ+WPlua2iCcsXG4gICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlcy5jb25maXJtKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5pdGVtQXBpLmxlbmRSZXR1cm4odGhpcy5kYXRhLml0ZW1MZW5kT3JkZXIuaWQpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXREZXRhaWwoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgfSxcbiAgICBsZW5kQ2FuY2VsKCkge1xuICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgICAgdGl0bGU6ICfnoa7lrprmkqTlm57mraTmrKHlgJ/pmIU/JyxcbiAgICAgICAgICAgIGNvbnRlbnQ6ICcnLFxuICAgICAgICAgICAgY29uZmlybVRleHQ6ICfnoa7lrponLFxuICAgICAgICAgICAgY2FuY2VsVGV4dDogJ+WPlua2iCcsXG4gICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHJlcy5jb25maXJtKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5pdGVtQXBpLmxlbmRDYW5jZWwodGhpcy5kYXRhLml0ZW1MZW5kT3JkZXIuaWQpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXREZXRhaWwoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgbGVuZERlbGV0ZSgpIHtcbiAgICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICAgIHRpdGxlOiAn56Gu5a6a6KaB5Yig6Zmk5q2k55Sz6K+3PycsXG4gICAgICAgICAgICBjb250ZW50OiAn5Yig6Zmk5ZCO5LiN5Y+v5oGi5aSNJyxcbiAgICAgICAgICAgIGNvbmZpcm1UZXh0OiAn56Gu5a6aJyxcbiAgICAgICAgICAgIGNhbmNlbFRleHQ6ICflj5bmtognLFxuICAgICAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChyZXMuY29uZmlybSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEuaXRlbUFwaS5sZW5kRGVsZXRlKHRoaXMuZGF0YS5pdGVtTGVuZE9yZGVyLmlkKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHd4Lm5hdmlnYXRlQmFjayh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsdGE6IDFcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG4iXX0=