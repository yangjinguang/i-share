"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var item_api_1 = require("../../../apis/item-api");
var student_api_1 = require("../../../apis/student-api");
var app = getApp();
Page({
    data: {
        studentApi: {},
        itemApi: {},
        profile: {},
        itemId: 0,
        students: [],
        studentsArr: [],
        studentIndex: 0,
    },
    onLoad: function (query) {
        this.setData({
            studentApi: new student_api_1.StudentApi(),
            itemApi: new item_api_1.ItemApi(),
            profile: app.globalData.profile,
            itemId: query.id
        });
    },
    onShow: function () {
        this.getStudents();
    },
    getStudents: function () {
        var _this = this;
        this.data.studentApi.getMy().then(function (result) {
            _this.setData({
                students: result,
                studentsArr: result.map(function (i) { return i.name; })
            });
        });
    },
    bindChildIndexChange: function (e) {
        this.setData({
            studentIndex: e.detail.value
        });
    },
    formSubmit: function () {
        var newRecord = {
            itemId: this.data.itemId,
            studentId: this.data.students[this.data.studentIndex].id
        };
        this.data.itemApi.lend(newRecord).then(function (result) {
            console.log(result);
            wx.navigateBack({
                delta: 1
            });
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9hbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImxvYW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxtREFBK0M7QUFJL0MseURBQXFEO0FBRXJELElBQU0sR0FBRyxHQUFHLE1BQU0sRUFBVSxDQUFDO0FBRTdCLElBQUksQ0FBQztJQUNELElBQUksRUFBRTtRQUNGLFVBQVUsRUFBYyxFQUFFO1FBQzFCLE9BQU8sRUFBVyxFQUFFO1FBQ3BCLE9BQU8sRUFBUSxFQUFFO1FBQ2pCLE1BQU0sRUFBRSxDQUFDO1FBQ1QsUUFBUSxFQUFhLEVBQUU7UUFDdkIsV0FBVyxFQUFZLEVBQUU7UUFDekIsWUFBWSxFQUFFLENBQUM7S0FDbEI7SUFDRCxNQUFNLEVBQU4sVUFBTyxLQUFVO1FBQ2IsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNULFVBQVUsRUFBRSxJQUFJLHdCQUFVLEVBQUU7WUFDNUIsT0FBTyxFQUFFLElBQUksa0JBQU8sRUFBRTtZQUN0QixPQUFPLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxPQUFPO1lBQy9CLE1BQU0sRUFBRSxLQUFLLENBQUMsRUFBRTtTQUNuQixDQUFDLENBQUM7SUFDUCxDQUFDO0lBQ0QsTUFBTTtRQUNGLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUN2QixDQUFDO0lBQ0QsV0FBVztRQUFYLGlCQWNDO1FBYkcsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQUEsTUFBTTtZQUNwQyxLQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNULFFBQVEsRUFBRSxNQUFNO2dCQUNoQixXQUFXLEVBQUUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLEVBQU4sQ0FBTSxDQUFDO2FBQ3ZDLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO0lBUVAsQ0FBQztJQUNELG9CQUFvQixFQUFwQixVQUFxQixDQUFNO1FBQ3ZCLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDVCxZQUFZLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLO1NBQy9CLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxVQUFVLEVBQVY7UUFDSSxJQUFNLFNBQVMsR0FBa0I7WUFDN0IsTUFBTSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTTtZQUN4QixTQUFTLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxFQUFFO1NBQzNELENBQUM7UUFDRixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsTUFBTTtZQUMxQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3BCLEVBQUUsQ0FBQyxZQUFZLENBQUM7Z0JBQ1osS0FBSyxFQUFFLENBQUM7YUFDWCxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7Q0FDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0l0ZW1MZW5kT3JkZXJ9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3R5cGVzL2l0ZW0tbGVuZC1vcmRlcic7XG5pbXBvcnQge0l0ZW1BcGl9IGZyb20gJy4uLy4uLy4uL2FwaXMvaXRlbS1hcGknO1xuaW1wb3J0IHtTdHVkZW50fSBmcm9tICcuLi8uLi8uLi91dGlscy90eXBlcy9zdHVkZW50JztcbmltcG9ydCB7VXNlcn0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdHlwZXMvdXNlcic7XG5pbXBvcnQge0lNeUFwcH0gZnJvbSAnLi4vLi4vLi4vYXBwJztcbmltcG9ydCB7U3R1ZGVudEFwaX0gZnJvbSAnLi4vLi4vLi4vYXBpcy9zdHVkZW50LWFwaSc7XG5cbmNvbnN0IGFwcCA9IGdldEFwcDxJTXlBcHA+KCk7XG5cblBhZ2Uoe1xuICAgIGRhdGE6IHtcbiAgICAgICAgc3R1ZGVudEFwaTogPFN0dWRlbnRBcGk+e30sXG4gICAgICAgIGl0ZW1BcGk6IDxJdGVtQXBpPnt9LFxuICAgICAgICBwcm9maWxlOiA8VXNlcj57fSxcbiAgICAgICAgaXRlbUlkOiAwLFxuICAgICAgICBzdHVkZW50czogPFN0dWRlbnRbXT5bXSxcbiAgICAgICAgc3R1ZGVudHNBcnI6IDxzdHJpbmdbXT5bXSxcbiAgICAgICAgc3R1ZGVudEluZGV4OiAwLFxuICAgIH0sXG4gICAgb25Mb2FkKHF1ZXJ5OiBhbnkpIHtcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgIHN0dWRlbnRBcGk6IG5ldyBTdHVkZW50QXBpKCksXG4gICAgICAgICAgICBpdGVtQXBpOiBuZXcgSXRlbUFwaSgpLFxuICAgICAgICAgICAgcHJvZmlsZTogYXBwLmdsb2JhbERhdGEucHJvZmlsZSxcbiAgICAgICAgICAgIGl0ZW1JZDogcXVlcnkuaWRcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBvblNob3coKSB7XG4gICAgICAgIHRoaXMuZ2V0U3R1ZGVudHMoKTtcbiAgICB9LFxuICAgIGdldFN0dWRlbnRzKCkge1xuICAgICAgICB0aGlzLmRhdGEuc3R1ZGVudEFwaS5nZXRNeSgpLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICAgICAgc3R1ZGVudHM6IHJlc3VsdCxcbiAgICAgICAgICAgICAgICBzdHVkZW50c0FycjogcmVzdWx0Lm1hcChpID0+IGkubmFtZSlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gdGhpcy5kYXRhLnVzZXJBcGkucHJvZmlsZSgpLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgLy8gICAgIGNvbnN0IGNoaWxkcmVuID0gcmVzdWx0ID8gcmVzdWx0LmNoaWxkcmVuUmVsYXRpb25zRGV0YWlscy5tYXAoaSA9PiBpLmNoaWxkKSA6IFtdO1xuICAgICAgICAvLyAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgLy8gICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sXG4gICAgICAgIC8vICAgICAgICAgY2hpbGRyZW5BcnI6IGNoaWxkcmVuLm1hcChpID0+IGkubmFtZSlcbiAgICAgICAgLy8gICAgIH0pO1xuICAgICAgICAvLyB9KTtcbiAgICB9LFxuICAgIGJpbmRDaGlsZEluZGV4Q2hhbmdlKGU6IGFueSkge1xuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgc3R1ZGVudEluZGV4OiBlLmRldGFpbC52YWx1ZVxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIGZvcm1TdWJtaXQoKSB7XG4gICAgICAgIGNvbnN0IG5ld1JlY29yZCA9IDxJdGVtTGVuZE9yZGVyPntcbiAgICAgICAgICAgIGl0ZW1JZDogdGhpcy5kYXRhLml0ZW1JZCxcbiAgICAgICAgICAgIHN0dWRlbnRJZDogdGhpcy5kYXRhLnN0dWRlbnRzW3RoaXMuZGF0YS5zdHVkZW50SW5kZXhdLmlkXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZGF0YS5pdGVtQXBpLmxlbmQobmV3UmVjb3JkKS50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XG4gICAgICAgICAgICB3eC5uYXZpZ2F0ZUJhY2soe1xuICAgICAgICAgICAgICAgIGRlbHRhOiAxXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG4iXX0=