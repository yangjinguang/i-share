"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var item_api_1 = require("../../../apis/item-api");
var utils_1 = require("../../../utils/utils");
Page({
    data: {
        from: 1,
        itemApi: {},
        itemId: 0,
        item: {}
    },
    onLoad: function (query) {
        this.setData({
            itemApi: new item_api_1.ItemApi(),
            itemId: Number(query.id),
            from: parseInt(query.from) || 1
        });
    },
    onShow: function () {
        if (this.data.itemId) {
            this.itemDetail(this.data.itemId);
        }
    },
    itemDetail: function (id) {
        var _this = this;
        this.data.itemApi.getOne(id).then(function (result) {
            result.tagsView = result.tags ? result.tags.map(function (i) { return i.name; }).join(',') : '';
            result.createdAtView = result.createdAt ? utils_1.Utils.dateFormat(new Date(result.createdAt), 'yyyy-MM-dd hh:mm:ss') : '';
            result.lend = result.status !== 1;
            _this.setData({
                item: result
            });
        });
    },
    itemLoan: function () {
        var item = this.data.item;
        wx.navigateTo({
            url: "/pages/item/loan/loan?id=" + item.id
        });
    },
    itemEdit: function () {
        var item = this.data.item;
        wx.navigateTo({
            url: "/pages/item/upload/upload?id=" + item.id
        });
    },
    itemDelete: function () {
        var _this = this;
        wx.showModal({
            title: '是否要删除此图书?',
            content: '删除后不可恢复',
            confirmText: '确定',
            cancelText: '取消',
            success: function (res) {
                console.log(res);
                if (res.confirm) {
                    if (_this.data.item.id) {
                        _this.data.itemApi.delete(_this.data.item.id).then(function () {
                            wx.navigateBack({
                                delta: 1
                            });
                        });
                    }
                }
                else {
                }
            }
        });
    },
    itemLoanCancel: function () {
        var _this = this;
        wx.showModal({
            title: '是否要强制取消借出状态?',
            content: '取消后不可恢复',
            confirmText: '确定',
            cancelText: '取消',
            success: function (res) {
                if (res.confirm) {
                    if (!_this.data.item.id) {
                        return;
                    }
                    _this.data.itemApi.cancelItemLoan(_this.data.item.id).then(function () {
                        if (_this.data.item.id) {
                            _this.itemDetail(_this.data.item.id);
                        }
                    });
                }
                else {
                }
            }
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV0YWlsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGV0YWlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsbURBQStDO0FBRS9DLDhDQUEyQztBQUUzQyxJQUFJLENBQUM7SUFDRCxJQUFJLEVBQUU7UUFDRixJQUFJLEVBQUUsQ0FBQztRQUNQLE9BQU8sRUFBVyxFQUFFO1FBQ3BCLE1BQU0sRUFBRSxDQUFDO1FBQ1QsSUFBSSxFQUFRLEVBQUU7S0FDakI7SUFDRCxNQUFNLEVBQU4sVUFBTyxLQUFVO1FBQ2IsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNULE9BQU8sRUFBRSxJQUFJLGtCQUFPLEVBQUU7WUFDdEIsTUFBTSxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ3hCLElBQUksRUFBRSxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7U0FDbEMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNELE1BQU07UUFDRixJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ2xCLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUNyQztJQUNMLENBQUM7SUFDRCxVQUFVLEVBQVYsVUFBVyxFQUFVO1FBQXJCLGlCQVNDO1FBUkcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLE1BQU07WUFDcEMsTUFBTSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxJQUFJLEVBQU4sQ0FBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDNUUsTUFBTSxDQUFDLGFBQWEsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxhQUFLLENBQUMsVUFBVSxDQUFDLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsRUFBRSxxQkFBcUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDbkgsTUFBTSxDQUFDLElBQUksR0FBRyxNQUFNLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztZQUNsQyxLQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNULElBQUksRUFBRSxNQUFNO2FBQ2YsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBQ0QsUUFBUTtRQUNKLElBQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQzVCLEVBQUUsQ0FBQyxVQUFVLENBQUM7WUFDVixHQUFHLEVBQUUsOEJBQTRCLElBQUksQ0FBQyxFQUFJO1NBQzdDLENBQUMsQ0FBQztJQUVQLENBQUM7SUFDRCxRQUFRO1FBQ0osSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDNUIsRUFBRSxDQUFDLFVBQVUsQ0FBQztZQUNWLEdBQUcsRUFBRSxrQ0FBZ0MsSUFBSSxDQUFDLEVBQUk7U0FDakQsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUNELFVBQVU7UUFBVixpQkFvQkM7UUFuQkcsRUFBRSxDQUFDLFNBQVMsQ0FBQztZQUNULEtBQUssRUFBRSxXQUFXO1lBQ2xCLE9BQU8sRUFBRSxTQUFTO1lBQ2xCLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLFVBQVUsRUFBRSxJQUFJO1lBQ2hCLE9BQU8sRUFBRSxVQUFDLEdBQUc7Z0JBQ1QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDakIsSUFBSSxHQUFHLENBQUMsT0FBTyxFQUFFO29CQUNiLElBQUksS0FBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFO3dCQUNuQixLQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDOzRCQUM3QyxFQUFFLENBQUMsWUFBWSxDQUFDO2dDQUNaLEtBQUssRUFBRSxDQUFDOzZCQUNYLENBQUMsQ0FBQzt3QkFDUCxDQUFDLENBQUMsQ0FBQztxQkFDTjtpQkFDSjtxQkFBTTtpQkFDTjtZQUNMLENBQUM7U0FDSixDQUFDLENBQUM7SUFDUCxDQUFDO0lBQ0QsY0FBYztRQUFkLGlCQW9CQztRQW5CRyxFQUFFLENBQUMsU0FBUyxDQUFDO1lBQ1QsS0FBSyxFQUFFLGNBQWM7WUFDckIsT0FBTyxFQUFFLFNBQVM7WUFDbEIsV0FBVyxFQUFFLElBQUk7WUFDakIsVUFBVSxFQUFFLElBQUk7WUFDaEIsT0FBTyxFQUFFLFVBQUMsR0FBRztnQkFDVCxJQUFJLEdBQUcsQ0FBQyxPQUFPLEVBQUU7b0JBQ2IsSUFBSSxDQUFDLEtBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRTt3QkFDcEIsT0FBTztxQkFDVjtvQkFDRCxLQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsS0FBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDO3dCQUNyRCxJQUFJLEtBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRTs0QkFDbkIsS0FBSSxDQUFDLFVBQVUsQ0FBQyxLQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQzt5QkFDdEM7b0JBQ0wsQ0FBQyxDQUFDLENBQUM7aUJBQ047cUJBQU07aUJBQ047WUFDTCxDQUFDO1NBQ0osQ0FBQyxDQUFDO0lBQ1AsQ0FBQztDQUNKLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SXRlbUFwaX0gZnJvbSAnLi4vLi4vLi4vYXBpcy9pdGVtLWFwaSc7XG5pbXBvcnQge0l0ZW19IGZyb20gJy4uLy4uLy4uL3V0aWxzL3R5cGVzL2l0ZW0nO1xuaW1wb3J0IHtVdGlsc30gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdXRpbHMnO1xuXG5QYWdlKHtcbiAgICBkYXRhOiB7XG4gICAgICAgIGZyb206IDEsXG4gICAgICAgIGl0ZW1BcGk6IDxJdGVtQXBpPnt9LFxuICAgICAgICBpdGVtSWQ6IDAsXG4gICAgICAgIGl0ZW06IDxJdGVtPnt9XG4gICAgfSxcbiAgICBvbkxvYWQocXVlcnk6IGFueSkge1xuICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgaXRlbUFwaTogbmV3IEl0ZW1BcGkoKSxcbiAgICAgICAgICAgIGl0ZW1JZDogTnVtYmVyKHF1ZXJ5LmlkKSxcbiAgICAgICAgICAgIGZyb206IHBhcnNlSW50KHF1ZXJ5LmZyb20pIHx8IDFcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBvblNob3coKSB7XG4gICAgICAgIGlmICh0aGlzLmRhdGEuaXRlbUlkKSB7XG4gICAgICAgICAgICB0aGlzLml0ZW1EZXRhaWwodGhpcy5kYXRhLml0ZW1JZCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGl0ZW1EZXRhaWwoaWQ6IG51bWJlcikge1xuICAgICAgICB0aGlzLmRhdGEuaXRlbUFwaS5nZXRPbmUoaWQpLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgIHJlc3VsdC50YWdzVmlldyA9IHJlc3VsdC50YWdzID8gcmVzdWx0LnRhZ3MubWFwKGkgPT4gaS5uYW1lKS5qb2luKCcsJykgOiAnJztcbiAgICAgICAgICAgIHJlc3VsdC5jcmVhdGVkQXRWaWV3ID0gcmVzdWx0LmNyZWF0ZWRBdCA/IFV0aWxzLmRhdGVGb3JtYXQobmV3IERhdGUocmVzdWx0LmNyZWF0ZWRBdCksICd5eXl5LU1NLWRkIGhoOm1tOnNzJykgOiAnJztcbiAgICAgICAgICAgIHJlc3VsdC5sZW5kID0gcmVzdWx0LnN0YXR1cyAhPT0gMTtcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICAgICAgaXRlbTogcmVzdWx0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBpdGVtTG9hbigpIHtcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZGF0YS5pdGVtO1xuICAgICAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgICAgICAgIHVybDogYC9wYWdlcy9pdGVtL2xvYW4vbG9hbj9pZD0ke2l0ZW0uaWR9YFxuICAgICAgICB9KTtcbiAgICAgICAgLy8gdGhpcy5kYXRhLml0ZW1BcGkubG9hbih0aGlzLmRhdGEuaXRlbS5pZClcbiAgICB9LFxuICAgIGl0ZW1FZGl0KCkge1xuICAgICAgICBjb25zdCBpdGVtID0gdGhpcy5kYXRhLml0ZW07XG4gICAgICAgIHd4Lm5hdmlnYXRlVG8oe1xuICAgICAgICAgICAgdXJsOiBgL3BhZ2VzL2l0ZW0vdXBsb2FkL3VwbG9hZD9pZD0ke2l0ZW0uaWR9YFxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIGl0ZW1EZWxldGUoKSB7XG4gICAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgICB0aXRsZTogJ+aYr+WQpuimgeWIoOmZpOatpOWbvuS5pj8nLFxuICAgICAgICAgICAgY29udGVudDogJ+WIoOmZpOWQjuS4jeWPr+aBouWkjScsXG4gICAgICAgICAgICBjb25maXJtVGV4dDogJ+ehruWumicsXG4gICAgICAgICAgICBjYW5jZWxUZXh0OiAn5Y+W5raIJyxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAgICAgICAgICAgICAgIGlmIChyZXMuY29uZmlybSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kYXRhLml0ZW0uaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5pdGVtQXBpLmRlbGV0ZSh0aGlzLmRhdGEuaXRlbS5pZCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd3gubmF2aWdhdGVCYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsdGE6IDFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgaXRlbUxvYW5DYW5jZWwoKSB7XG4gICAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgICB0aXRsZTogJ+aYr+WQpuimgeW8uuWItuWPlua2iOWAn+WHuueKtuaAgT8nLFxuICAgICAgICAgICAgY29udGVudDogJ+WPlua2iOWQjuS4jeWPr+aBouWkjScsXG4gICAgICAgICAgICBjb25maXJtVGV4dDogJ+ehruWumicsXG4gICAgICAgICAgICBjYW5jZWxUZXh0OiAn5Y+W5raIJyxcbiAgICAgICAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzLmNvbmZpcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLmRhdGEuaXRlbS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5pdGVtQXBpLmNhbmNlbEl0ZW1Mb2FuKHRoaXMuZGF0YS5pdGVtLmlkKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhdGEuaXRlbS5pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbURldGFpbCh0aGlzLmRhdGEuaXRlbS5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG59KTtcbiJdfQ==