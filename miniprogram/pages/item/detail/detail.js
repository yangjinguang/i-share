"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var item_api_1 = require("../../../apis/item-api");
var utils_1 = require("../../../utils/utils");
Page({
    data: {
        from: 1,
        itemApi: {},
        itemId: 0,
        item: {}
    },
    onLoad: function (query) {
        this.setData({
            itemApi: new item_api_1.ItemApi(),
            itemId: Number(query.id),
            from: parseInt(query.from) || 1
        });
    },
    onShow: function () {
        if (this.data.itemId) {
            this.itemDetail(this.data.itemId);
        }
    },
    itemDetail: function (id) {
        var _this = this;
        this.data.itemApi.getOne(id).then(function (result) {
            result.tagsView = result.tags ? result.tags.map(function (i) { return i.name; }).join(',') : '';
            result.createdAtView = result.createdAt ? utils_1.Utils.dateFormat(new Date(result.createdAt), 'yyyy-MM-dd hh:mm:ss') : '';
            result.lend = result.status !== 1;
            result.popularShares.forEach(function (i) {
                utils_1.Utils.shareMediaSerialize(.5, i);
            });
            _this.setData({
                item: result
            });
        });
    },
    itemLoan: function () {
        var item = this.data.item;
        wx.navigateTo({
            url: "/pages/item/loan/loan?id=" + item.id
        });
    },
    itemEdit: function () {
        var item = this.data.item;
        wx.navigateTo({
            url: "/pages/item/upload/upload?id=" + item.id
        });
    },
    itemDelete: function () {
        var _this = this;
        wx.showModal({
            title: '是否要删除此图书?',
            content: '删除后不可恢复',
            confirmText: '确定',
            cancelText: '取消',
            success: function (res) {
                console.log(res);
                if (res.confirm) {
                    if (_this.data.item.id) {
                        _this.data.itemApi.delete(_this.data.item.id).then(function () {
                            wx.navigateBack({
                                delta: 1
                            });
                        });
                    }
                }
                else {
                }
            }
        });
    },
    itemLoanCancel: function () {
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGV0YWlsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZGV0YWlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsbURBQStDO0FBRS9DLDhDQUEyQztBQUUzQyxJQUFJLENBQUM7SUFDRCxJQUFJLEVBQUU7UUFDRixJQUFJLEVBQUUsQ0FBQztRQUNQLE9BQU8sRUFBVyxFQUFFO1FBQ3BCLE1BQU0sRUFBRSxDQUFDO1FBQ1QsSUFBSSxFQUFRLEVBQUU7S0FDakI7SUFDRCxNQUFNLFlBQUMsS0FBVTtRQUNiLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDVCxPQUFPLEVBQUUsSUFBSSxrQkFBTyxFQUFFO1lBQ3RCLE1BQU0sRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUN4QixJQUFJLEVBQUUsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1NBQ2xDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxNQUFNO1FBQ0YsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtZQUNsQixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7U0FDckM7SUFDTCxDQUFDO0lBQ0QsVUFBVSxZQUFDLEVBQVU7UUFBckIsaUJBWUM7UUFYRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUEsTUFBTTtZQUNwQyxNQUFNLENBQUMsUUFBUSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLElBQUksRUFBTixDQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUM1RSxNQUFNLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLGFBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxFQUFFLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNuSCxNQUFNLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQztnQkFDMUIsYUFBSyxDQUFDLG1CQUFtQixDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNyQyxDQUFDLENBQUMsQ0FBQztZQUNILEtBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQ1QsSUFBSSxFQUFFLE1BQU07YUFDZixDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxRQUFRO1FBQ0osSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDNUIsRUFBRSxDQUFDLFVBQVUsQ0FBQztZQUNWLEdBQUcsRUFBRSw4QkFBNEIsSUFBSSxDQUFDLEVBQUk7U0FDN0MsQ0FBQyxDQUFDO0lBRVAsQ0FBQztJQUNELFFBQVE7UUFDSixJQUFNLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztRQUM1QixFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1YsR0FBRyxFQUFFLGtDQUFnQyxJQUFJLENBQUMsRUFBSTtTQUNqRCxDQUFDLENBQUM7SUFDUCxDQUFDO0lBQ0QsVUFBVTtRQUFWLGlCQW9CQztRQW5CRyxFQUFFLENBQUMsU0FBUyxDQUFDO1lBQ1QsS0FBSyxFQUFFLFdBQVc7WUFDbEIsT0FBTyxFQUFFLFNBQVM7WUFDbEIsV0FBVyxFQUFFLElBQUk7WUFDakIsVUFBVSxFQUFFLElBQUk7WUFDaEIsT0FBTyxFQUFFLFVBQUMsR0FBRztnQkFDVCxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNqQixJQUFJLEdBQUcsQ0FBQyxPQUFPLEVBQUU7b0JBQ2IsSUFBSSxLQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUU7d0JBQ25CLEtBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUM7NEJBQzdDLEVBQUUsQ0FBQyxZQUFZLENBQUM7Z0NBQ1osS0FBSyxFQUFFLENBQUM7NkJBQ1gsQ0FBQyxDQUFDO3dCQUNQLENBQUMsQ0FBQyxDQUFDO3FCQUNOO2lCQUNKO3FCQUFNO2lCQUNOO1lBQ0wsQ0FBQztTQUNKLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxjQUFjO0lBb0JkLENBQUM7Q0FDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0l0ZW1BcGl9IGZyb20gJy4uLy4uLy4uL2FwaXMvaXRlbS1hcGknO1xuaW1wb3J0IHtJdGVtfSBmcm9tICcuLi8uLi8uLi91dGlscy90eXBlcy9pdGVtJztcbmltcG9ydCB7VXRpbHN9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3V0aWxzJztcblxuUGFnZSh7XG4gICAgZGF0YToge1xuICAgICAgICBmcm9tOiAxLFxuICAgICAgICBpdGVtQXBpOiA8SXRlbUFwaT57fSxcbiAgICAgICAgaXRlbUlkOiAwLFxuICAgICAgICBpdGVtOiA8SXRlbT57fVxuICAgIH0sXG4gICAgb25Mb2FkKHF1ZXJ5OiBhbnkpIHtcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgIGl0ZW1BcGk6IG5ldyBJdGVtQXBpKCksXG4gICAgICAgICAgICBpdGVtSWQ6IE51bWJlcihxdWVyeS5pZCksXG4gICAgICAgICAgICBmcm9tOiBwYXJzZUludChxdWVyeS5mcm9tKSB8fCAxXG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgb25TaG93KCkge1xuICAgICAgICBpZiAodGhpcy5kYXRhLml0ZW1JZCkge1xuICAgICAgICAgICAgdGhpcy5pdGVtRGV0YWlsKHRoaXMuZGF0YS5pdGVtSWQpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBpdGVtRGV0YWlsKGlkOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5kYXRhLml0ZW1BcGkuZ2V0T25lKGlkKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICByZXN1bHQudGFnc1ZpZXcgPSByZXN1bHQudGFncyA/IHJlc3VsdC50YWdzLm1hcChpID0+IGkubmFtZSkuam9pbignLCcpIDogJyc7XG4gICAgICAgICAgICByZXN1bHQuY3JlYXRlZEF0VmlldyA9IHJlc3VsdC5jcmVhdGVkQXQgPyBVdGlscy5kYXRlRm9ybWF0KG5ldyBEYXRlKHJlc3VsdC5jcmVhdGVkQXQpLCAneXl5eS1NTS1kZCBoaDptbTpzcycpIDogJyc7XG4gICAgICAgICAgICByZXN1bHQubGVuZCA9IHJlc3VsdC5zdGF0dXMgIT09IDE7XG4gICAgICAgICAgICByZXN1bHQucG9wdWxhclNoYXJlcy5mb3JFYWNoKGkgPT4ge1xuICAgICAgICAgICAgICAgIFV0aWxzLnNoYXJlTWVkaWFTZXJpYWxpemUoLjUsIGkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgICAgIGl0ZW06IHJlc3VsdFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgaXRlbUxvYW4oKSB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmRhdGEuaXRlbTtcbiAgICAgICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICAgICAgICB1cmw6IGAvcGFnZXMvaXRlbS9sb2FuL2xvYW4/aWQ9JHtpdGVtLmlkfWBcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIHRoaXMuZGF0YS5pdGVtQXBpLmxvYW4odGhpcy5kYXRhLml0ZW0uaWQpXG4gICAgfSxcbiAgICBpdGVtRWRpdCgpIHtcbiAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZGF0YS5pdGVtO1xuICAgICAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgICAgICAgIHVybDogYC9wYWdlcy9pdGVtL3VwbG9hZC91cGxvYWQ/aWQ9JHtpdGVtLmlkfWBcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBpdGVtRGVsZXRlKCkge1xuICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgICAgdGl0bGU6ICfmmK/lkKbopoHliKDpmaTmraTlm77kuaY/JyxcbiAgICAgICAgICAgIGNvbnRlbnQ6ICfliKDpmaTlkI7kuI3lj6/mgaLlpI0nLFxuICAgICAgICAgICAgY29uZmlybVRleHQ6ICfnoa7lrponLFxuICAgICAgICAgICAgY2FuY2VsVGV4dDogJ+WPlua2iCcsXG4gICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzLmNvbmZpcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZGF0YS5pdGVtLmlkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEuaXRlbUFwaS5kZWxldGUodGhpcy5kYXRhLml0ZW0uaWQpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHd4Lm5hdmlnYXRlQmFjayh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbHRhOiAxXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIGl0ZW1Mb2FuQ2FuY2VsKCkge1xuICAgICAgICAvLyB3eC5zaG93TW9kYWwoe1xuICAgICAgICAvLyAgICAgdGl0bGU6ICfmmK/lkKbopoHlvLrliLblj5bmtojlgJ/lh7rnirbmgIE/JyxcbiAgICAgICAgLy8gICAgIGNvbnRlbnQ6ICflj5bmtojlkI7kuI3lj6/mgaLlpI0nLFxuICAgICAgICAvLyAgICAgY29uZmlybVRleHQ6ICfnoa7lrponLFxuICAgICAgICAvLyAgICAgY2FuY2VsVGV4dDogJ+WPlua2iCcsXG4gICAgICAgIC8vICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgIC8vICAgICAgICAgaWYgKHJlcy5jb25maXJtKSB7XG4gICAgICAgIC8vICAgICAgICAgICAgIGlmICghdGhpcy5kYXRhLml0ZW0uaWQpIHtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgLy8gICAgICAgICAgICAgfVxuICAgICAgICAvLyAgICAgICAgICAgICB0aGlzLmRhdGEuaXRlbUFwaS5jYW5jZWxJdGVtTG9hbih0aGlzLmRhdGEuaXRlbS5pZCkudGhlbigoKSA9PiB7XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICBpZiAodGhpcy5kYXRhLml0ZW0uaWQpIHtcbiAgICAgICAgLy8gICAgICAgICAgICAgICAgICAgICB0aGlzLml0ZW1EZXRhaWwodGhpcy5kYXRhLml0ZW0uaWQpO1xuICAgICAgICAvLyAgICAgICAgICAgICAgICAgfVxuICAgICAgICAvLyAgICAgICAgICAgICB9KTtcbiAgICAgICAgLy8gICAgICAgICB9IGVsc2Uge1xuICAgICAgICAvLyAgICAgICAgIH1cbiAgICAgICAgLy8gICAgIH1cbiAgICAgICAgLy8gfSk7XG4gICAgfVxufSk7XG4iXX0=