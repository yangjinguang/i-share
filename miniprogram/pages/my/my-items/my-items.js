"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var item_api_1 = require("../../../apis/item-api");
var utils_1 = require("../../../utils/utils");
Page({
    data: {
        curTab: 2,
        itemApi: {},
        lendOrders: [],
        tabStatusList: [
            [1, 3, 4],
            [2, 5, 7],
            [6]
        ],
        pagination: {
            page: 1,
            size: 20
        }
    },
    onLoad: function () {
        this.setData({
            itemApi: new item_api_1.ItemApi()
        });
    },
    onShow: function () {
        this.getRecords();
    },
    getRecords: function (page) {
        var _this = this;
        page = page || this.data.pagination.page;
        var size = this.data.pagination.size;
        this.data.itemApi.getMyLendOrders(this.data.tabStatusList[this.data.curTab - 1], page, size).then(function (result) {
            result = result || [];
            console.log(result.list);
            result.list.forEach(function (l) {
                l.createdAtView = l.createdAt ? utils_1.Utils.dateFormat(new Date(l.createdAt), 'yyyy-MM-dd hh:mm:ss') : '';
            });
            _this.setData({
                lendOrders: result.list
            });
        });
    },
    tagSwitch: function (e) {
        var index = parseInt(e.currentTarget.dataset.tabIndex);
        if (index && index !== this.data.curTab) {
            this.setData({
                curTab: index
            });
            this.getRecords();
        }
    },
    itemDetail: function (e) {
        var itemId = e.currentTarget.dataset.itemId;
        console.log(itemId);
        if (itemId) {
            wx.navigateTo({
                url: "/pages/item/detail/detail?id=" + itemId
            });
        }
    },
    recordAction: function (e) {
        var _this = this;
        console.log(e);
        var orderId = e.currentTarget.dataset.orderId;
        switch (this.data.curTab) {
            case 1:
                wx.showActionSheet({
                    itemList: ['撤回'],
                    success: function () {
                        if (orderId) {
                            _this.data.itemApi.lendCancel(orderId).then(function () {
                                _this.getRecords();
                            });
                        }
                    }
                });
                break;
            case 2:
                wx.showActionSheet({
                    itemList: ['退还'],
                    success: function () {
                        if (orderId) {
                            _this.data.itemApi.lendReturn(orderId).then(function () {
                                _this.getRecords();
                            });
                        }
                    }
                });
                break;
            case 3:
                wx.showActionSheet({
                    itemList: ['删除'],
                    success: function () {
                        if (orderId) {
                            _this.data.itemApi.lendDelete(orderId).then(function () {
                                _this.getRecords();
                            });
                        }
                    }
                });
                break;
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXktaXRlbXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJteS1pdGVtcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1EQUErQztBQUcvQyw4Q0FBMkM7QUFFM0MsSUFBSSxDQUFDO0lBQ0QsSUFBSSxFQUFFO1FBQ0YsTUFBTSxFQUFFLENBQUM7UUFDVCxPQUFPLEVBQVcsRUFBRTtRQUNwQixVQUFVLEVBQW1CLEVBQUU7UUFDL0IsYUFBYSxFQUFFO1lBQ1gsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztZQUNQLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7WUFDUCxDQUFDLENBQUMsQ0FBQztTQUNOO1FBQ0QsVUFBVSxFQUFjO1lBQ3BCLElBQUksRUFBRSxDQUFDO1lBQ1AsSUFBSSxFQUFFLEVBQUU7U0FDWDtLQUVKO0lBQ0QsTUFBTTtRQUNGLElBQUksQ0FBQyxPQUFPLENBQUM7WUFDVCxPQUFPLEVBQUUsSUFBSSxrQkFBTyxFQUFFO1NBQ3pCLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxNQUFNO1FBQ0YsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUFDRCxVQUFVLFlBQUMsSUFBYTtRQUF4QixpQkFhQztRQVpHLElBQUksR0FBRyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO1FBQ3pDLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQztRQUNyQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLE1BQU07WUFDcEcsTUFBTSxHQUFHLE1BQU0sSUFBSSxF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LENBQUMsVUFBVSxFQUFFLENBQUM7NEJBQ3RCLENBQUMsQ0FBQyxDQUFDO3lCQUNOO29CQUNMLENBQUM7aUJBQ0osQ0FBQyxDQUFDO2dCQUNILE1BQU07U0FDYjtJQUVMLENBQUM7Q0FDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0l0ZW1BcGl9IGZyb20gJy4uLy4uLy4uL2FwaXMvaXRlbS1hcGknO1xuaW1wb3J0IHtJdGVtTGVuZE9yZGVyfSBmcm9tICcuLi8uLi8uLi91dGlscy90eXBlcy9pdGVtLWxlbmQtb3JkZXInO1xuaW1wb3J0IHtQYWdpbmF0aW9ufSBmcm9tICcuLi8uLi8uLi91dGlscy90eXBlcy9wYWdpbmF0aW9uJztcbmltcG9ydCB7VXRpbHN9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3V0aWxzJztcblxuUGFnZSh7XG4gICAgZGF0YToge1xuICAgICAgICBjdXJUYWI6IDIsXG4gICAgICAgIGl0ZW1BcGk6IDxJdGVtQXBpPnt9LFxuICAgICAgICBsZW5kT3JkZXJzOiA8SXRlbUxlbmRPcmRlcltdPltdLFxuICAgICAgICB0YWJTdGF0dXNMaXN0OiBbXG4gICAgICAgICAgICBbMSwzLDRdLFxuICAgICAgICAgICAgWzIsNSw3XSxcbiAgICAgICAgICAgIFs2XVxuICAgICAgICBdLFxuICAgICAgICBwYWdpbmF0aW9uOiA8UGFnaW5hdGlvbj57XG4gICAgICAgICAgICBwYWdlOiAxLFxuICAgICAgICAgICAgc2l6ZTogMjBcbiAgICAgICAgfVxuXG4gICAgfSxcbiAgICBvbkxvYWQoKSB7XG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICBpdGVtQXBpOiBuZXcgSXRlbUFwaSgpXG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgb25TaG93KCkge1xuICAgICAgICB0aGlzLmdldFJlY29yZHMoKTtcbiAgICB9LFxuICAgIGdldFJlY29yZHMocGFnZT86IG51bWJlcikge1xuICAgICAgICBwYWdlID0gcGFnZSB8fCB0aGlzLmRhdGEucGFnaW5hdGlvbi5wYWdlO1xuICAgICAgICBsZXQgc2l6ZSA9IHRoaXMuZGF0YS5wYWdpbmF0aW9uLnNpemU7XG4gICAgICAgIHRoaXMuZGF0YS5pdGVtQXBpLmdldE15TGVuZE9yZGVycyh0aGlzLmRhdGEudGFiU3RhdHVzTGlzdFt0aGlzLmRhdGEuY3VyVGFiIC0gMV0sIHBhZ2UsIHNpemUpLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdCB8fCBbXTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3VsdC5saXN0KTtcbiAgICAgICAgICAgIHJlc3VsdC5saXN0LmZvckVhY2gobCA9PiB7XG4gICAgICAgICAgICAgICAgbC5jcmVhdGVkQXRWaWV3ID0gbC5jcmVhdGVkQXQgPyBVdGlscy5kYXRlRm9ybWF0KG5ldyBEYXRlKGwuY3JlYXRlZEF0KSwgJ3l5eXktTU0tZGQgaGg6bW06c3MnKSA6ICcnO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgICAgIGxlbmRPcmRlcnM6IHJlc3VsdC5saXN0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICB0YWdTd2l0Y2goZTogYW55KSB7XG4gICAgICAgIGNvbnN0IGluZGV4ID0gcGFyc2VJbnQoZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQudGFiSW5kZXgpO1xuICAgICAgICBpZiAoaW5kZXggJiYgaW5kZXggIT09IHRoaXMuZGF0YS5jdXJUYWIpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICAgICAgY3VyVGFiOiBpbmRleFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmdldFJlY29yZHMoKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgaXRlbURldGFpbChlOiBhbnkpIHtcbiAgICAgICAgY29uc3QgaXRlbUlkID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaXRlbUlkO1xuICAgICAgICBjb25zb2xlLmxvZyhpdGVtSWQpO1xuICAgICAgICBpZiAoaXRlbUlkKSB7XG4gICAgICAgICAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgICAgICAgICAgICB1cmw6IGAvcGFnZXMvaXRlbS9kZXRhaWwvZGV0YWlsP2lkPSR7aXRlbUlkfWBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICByZWNvcmRBY3Rpb24oZTogYW55KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgICBjb25zdCBvcmRlcklkID0gZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQub3JkZXJJZDtcbiAgICAgICAgc3dpdGNoICh0aGlzLmRhdGEuY3VyVGFiKSB7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgd3guc2hvd0FjdGlvblNoZWV0KHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbUxpc3Q6IFsn5pKk5ZueJ10sXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcmRlcklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhLml0ZW1BcGkubGVuZENhbmNlbChvcmRlcklkKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRSZWNvcmRzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICB3eC5zaG93QWN0aW9uU2hlZXQoe1xuICAgICAgICAgICAgICAgICAgICBpdGVtTGlzdDogWyfpgIDov5gnXSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9yZGVySWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEuaXRlbUFwaS5sZW5kUmV0dXJuKG9yZGVySWQpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFJlY29yZHMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgIHd4LnNob3dBY3Rpb25TaGVldCh7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1MaXN0OiBbJ+WIoOmZpCddLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3JkZXJJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5pdGVtQXBpLmxlbmREZWxldGUob3JkZXJJZCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0UmVjb3JkcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgIH1cbn0pO1xuIl19