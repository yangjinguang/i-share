"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var item_api_1 = require("../../../apis/item-api");
var utils_1 = require("../../../utils/utils");
Page({
    data: {
        curTab: 2,
        itemApi: {},
        lendOrders: [],
        tabStatusList: [
            [1, 3, 4],
            [2, 5, 7],
            [6]
        ],
        pagination: {
            page: 1,
            size: 20
        }
    },
    onLoad: function () {
        this.setData({
            itemApi: new item_api_1.ItemApi()
        });
    },
    onShow: function () {
        this.getRecords();
    },
    getRecords: function (page) {
        var _this = this;
        page = page || this.data.pagination.page;
        var size = this.data.pagination.size;
        this.data.itemApi.getMyLendOrders(this.data.tabStatusList[this.data.curTab - 1], page, size).then(function (result) {
            result = result || [];
            console.log(result.list);
            result.list.forEach(function (l) {
                l.createdAtView = l.createdAt ? utils_1.Utils.dateFormat(new Date(l.createdAt), 'yyyy-MM-dd hh:mm:ss') : '';
            });
            _this.setData({
                lendOrders: result.list
            });
        });
    },
    tagSwitch: function (e) {
        var index = parseInt(e.currentTarget.dataset.tabIndex);
        if (index && index !== this.data.curTab) {
            this.setData({
                curTab: index
            });
            this.getRecords();
        }
    },
    itemDetail: function (e) {
        var itemId = e.currentTarget.dataset.itemId;
        console.log(itemId);
        if (itemId) {
            wx.navigateTo({
                url: "/pages/item/detail/detail?id=" + itemId
            });
        }
    },
    recordAction: function (e) {
        var _this = this;
        console.log(e);
        var orderId = e.currentTarget.dataset.orderId;
        switch (this.data.curTab) {
            case 1:
                wx.showActionSheet({
                    itemList: ['撤回'],
                    success: function () {
                        if (orderId) {
                            _this.data.itemApi.lendCancel(orderId).then(function () {
                                _this.getRecords();
                            });
                        }
                    }
                });
                break;
            case 2:
                wx.showActionSheet({
                    itemList: ['退还'],
                    success: function () {
                        if (orderId) {
                            _this.data.itemApi.lendReturn(orderId).then(function () {
                                _this.getRecords();
                            });
                        }
                    }
                });
                break;
            case 3:
                wx.showActionSheet({
                    itemList: ['删除'],
                    success: function () {
                        if (orderId) {
                            _this.data.itemApi.lendDelete(orderId).then(function () {
                                _this.getRecords();
                            });
                        }
                    }
                });
                break;
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibXktaXRlbXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJteS1pdGVtcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1EQUErQztBQUcvQyw4Q0FBMkM7QUFFM0MsSUFBSSxDQUFDO0lBQ0QsSUFBSSxFQUFFO1FBQ0YsTUFBTSxFQUFFLENBQUM7UUFDVCxPQUFPLEVBQVcsRUFBRTtRQUNwQixVQUFVLEVBQW1CLEVBQUU7UUFDL0IsYUFBYSxFQUFFO1lBQ1gsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztZQUNQLENBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7WUFDUCxDQUFDLENBQUMsQ0FBQztTQUNOO1FBQ0QsVUFBVSxFQUFjO1lBQ3BCLElBQUksRUFBRSxDQUFDO1lBQ1AsSUFBSSxFQUFFLEVBQUU7U0FDWDtLQUVKO0lBQ0QsTUFBTTtRQUNGLElBQUksQ0FBQyxPQUFRLENBQUM7WUFDVixPQUFPLEVBQUUsSUFBSSxrQkFBTyxFQUFFO1NBQ3pCLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxNQUFNO1FBQ0YsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUFDRCxVQUFVLFlBQUMsSUFBYTtRQUF4QixpQkFhQztRQVpHLElBQUksR0FBRyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO1FBQ3pDLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQztRQUNyQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLE1BQU07WUFDcEcsTUFBTSxHQUFHLE1BQU0sSUFBSSxF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LENBQUMsVUFBVSxFQUFFLENBQUM7NEJBQ3RCLENBQUMsQ0FBQyxDQUFDO3lCQUNOO29CQUNMLENBQUM7aUJBQ0osQ0FBQyxDQUFDO2dCQUNILE1BQU07U0FDYjtJQUVMLENBQUM7Q0FDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0l0ZW1BcGl9IGZyb20gJy4uLy4uLy4uL2FwaXMvaXRlbS1hcGknO1xuaW1wb3J0IHtJdGVtTGVuZE9yZGVyfSBmcm9tICcuLi8uLi8uLi91dGlscy90eXBlcy9pdGVtLWxlbmQtb3JkZXInO1xuaW1wb3J0IHtQYWdpbmF0aW9ufSBmcm9tICcuLi8uLi8uLi91dGlscy90eXBlcy9wYWdpbmF0aW9uJztcbmltcG9ydCB7VXRpbHN9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3V0aWxzJztcblxuUGFnZSh7XG4gICAgZGF0YToge1xuICAgICAgICBjdXJUYWI6IDIsXG4gICAgICAgIGl0ZW1BcGk6IDxJdGVtQXBpPnt9LFxuICAgICAgICBsZW5kT3JkZXJzOiA8SXRlbUxlbmRPcmRlcltdPltdLFxuICAgICAgICB0YWJTdGF0dXNMaXN0OiBbXG4gICAgICAgICAgICBbMSwzLDRdLFxuICAgICAgICAgICAgWzIsNSw3XSxcbiAgICAgICAgICAgIFs2XVxuICAgICAgICBdLFxuICAgICAgICBwYWdpbmF0aW9uOiA8UGFnaW5hdGlvbj57XG4gICAgICAgICAgICBwYWdlOiAxLFxuICAgICAgICAgICAgc2l6ZTogMjBcbiAgICAgICAgfVxuXG4gICAgfSxcbiAgICBvbkxvYWQoKSB7XG4gICAgICAgIHRoaXMuc2V0RGF0YSEoe1xuICAgICAgICAgICAgaXRlbUFwaTogbmV3IEl0ZW1BcGkoKVxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIG9uU2hvdygpIHtcbiAgICAgICAgdGhpcy5nZXRSZWNvcmRzKCk7XG4gICAgfSxcbiAgICBnZXRSZWNvcmRzKHBhZ2U/OiBudW1iZXIpIHtcbiAgICAgICAgcGFnZSA9IHBhZ2UgfHwgdGhpcy5kYXRhLnBhZ2luYXRpb24ucGFnZTtcbiAgICAgICAgbGV0IHNpemUgPSB0aGlzLmRhdGEucGFnaW5hdGlvbi5zaXplO1xuICAgICAgICB0aGlzLmRhdGEuaXRlbUFwaS5nZXRNeUxlbmRPcmRlcnModGhpcy5kYXRhLnRhYlN0YXR1c0xpc3RbdGhpcy5kYXRhLmN1clRhYiAtIDFdLCBwYWdlLCBzaXplKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICByZXN1bHQgPSByZXN1bHQgfHwgW107XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQubGlzdCk7XG4gICAgICAgICAgICByZXN1bHQubGlzdC5mb3JFYWNoKGwgPT4ge1xuICAgICAgICAgICAgICAgIGwuY3JlYXRlZEF0VmlldyA9IGwuY3JlYXRlZEF0ID8gVXRpbHMuZGF0ZUZvcm1hdChuZXcgRGF0ZShsLmNyZWF0ZWRBdCksICd5eXl5LU1NLWRkIGhoOm1tOnNzJykgOiAnJztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgICAgICBsZW5kT3JkZXJzOiByZXN1bHQubGlzdFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgdGFnU3dpdGNoKGU6IGFueSkge1xuICAgICAgICBjb25zdCBpbmRleCA9IHBhcnNlSW50KGUuY3VycmVudFRhcmdldC5kYXRhc2V0LnRhYkluZGV4KTtcbiAgICAgICAgaWYgKGluZGV4ICYmIGluZGV4ICE9PSB0aGlzLmRhdGEuY3VyVGFiKSB7XG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgICAgIGN1clRhYjogaW5kZXhcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5nZXRSZWNvcmRzKCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGl0ZW1EZXRhaWwoZTogYW55KSB7XG4gICAgICAgIGNvbnN0IGl0ZW1JZCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0Lml0ZW1JZDtcbiAgICAgICAgY29uc29sZS5sb2coaXRlbUlkKTtcbiAgICAgICAgaWYgKGl0ZW1JZCkge1xuICAgICAgICAgICAgd3gubmF2aWdhdGVUbyh7XG4gICAgICAgICAgICAgICAgdXJsOiBgL3BhZ2VzL2l0ZW0vZGV0YWlsL2RldGFpbD9pZD0ke2l0ZW1JZH1gXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgcmVjb3JkQWN0aW9uKGU6IGFueSkge1xuICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgY29uc3Qgb3JkZXJJZCA9IGUuY3VycmVudFRhcmdldC5kYXRhc2V0Lm9yZGVySWQ7XG4gICAgICAgIHN3aXRjaCAodGhpcy5kYXRhLmN1clRhYikge1xuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgIHd4LnNob3dBY3Rpb25TaGVldCh7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW1MaXN0OiBbJ+aSpOWbniddLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3JkZXJJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5pdGVtQXBpLmxlbmRDYW5jZWwob3JkZXJJZCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0UmVjb3JkcygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgd3guc2hvd0FjdGlvblNoZWV0KHtcbiAgICAgICAgICAgICAgICAgICAgaXRlbUxpc3Q6IFsn6YCA6L+YJ10sXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcmRlcklkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhLml0ZW1BcGkubGVuZFJldHVybihvcmRlcklkKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRSZWNvcmRzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICB3eC5zaG93QWN0aW9uU2hlZXQoe1xuICAgICAgICAgICAgICAgICAgICBpdGVtTGlzdDogWyfliKDpmaQnXSxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9yZGVySWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEuaXRlbUFwaS5sZW5kRGVsZXRlKG9yZGVySWQpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFJlY29yZHMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICB9XG59KTtcbiJdfQ==