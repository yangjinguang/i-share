"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var item_api_1 = require("../../../../apis/item-api");
var upload_image_item_1 = require("../../../../utils/types/upload-image-item");
var settings_api_1 = require("../../../../apis/settings-api");
Page({
    data: {
        swiperImages: [],
        uploadImages: [],
        itemApi: {},
        settingsApi: {},
        banners: [],
        upToken: '',
    },
    onLoad: function () {
        var _this = this;
        this.setData({
            itemApi: new item_api_1.ItemApi(),
            settingsApi: new settings_api_1.SettingsApi()
        });
        this.data.settingsApi.uploadToken().then(function (result) {
            _this.setData({
                upToken: result,
                swiperImages: []
            });
        });
        this.getSwiper();
    },
    getSwiper: function () {
        var _this = this;
        this.data.settingsApi.getBanners().then(function (result) {
            _this.setData({
                banners: result,
                swiperImages: result.map(function (i) {
                    return {
                        fileName: i.imageUrl.split('/')[i.imageUrl.split('/').length - 1],
                        tempPath: i.imageUrl,
                        completed: true,
                        success: true
                    };
                })
            });
        });
    },
    imageAction: function (e) {
        var _this = this;
        wx.showActionSheet({
            itemList: ['删除'],
            success: function (res) {
                switch (res.tapIndex) {
                    case 0:
                        console.log(e.currentTarget.dataset);
                        var swiperImages = _this.data.swiperImages;
                        swiperImages.splice(e.currentTarget.dataset.imageIndex, 1);
                        _this.setData({
                            swiperImages: swiperImages
                        });
                }
            }
        });
    },
    chooseImage: function () {
        var _this = this;
        wx.chooseImage({
            success: function (res) {
                var uploadImageItemObj = new upload_image_item_1.UploadImageItemObj(_this.data.upToken, res.tempFilePaths[0], 'index_swiper', function (d) {
                    if (d) {
                        var swiperImages_1 = _this.data.swiperImages;
                        swiperImages_1.forEach(function (i) {
                            if (i.fileName === d.fileName) {
                                i.progress = d.progress;
                                i.completed = d.completed;
                                i.success = d.success;
                            }
                        });
                        _this.setData({
                            swiperImages: swiperImages_1
                        });
                    }
                });
                var swiperImages = _this.data.swiperImages;
                swiperImages.push(uploadImageItemObj);
                _this.setData({
                    swiperImages: swiperImages
                });
                uploadImageItemObj.upload();
            }
        });
    },
    submit: function () {
        var images = this.data.swiperImages.map(function (i) { return i.fileName; });
        this.data.settingsApi.updateBanners(images).then(function () {
            wx.showToast({
                title: '保存成功',
            });
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3dpcGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3dpcGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0Esc0RBQWtEO0FBQ2xELCtFQUE4RjtBQUM5Riw4REFBMEQ7QUFHMUQsSUFBSSxDQUFDO0lBQ0QsSUFBSSxFQUFFO1FBQ0YsWUFBWSxFQUFxQixFQUFFO1FBQ25DLFlBQVksRUFBWSxFQUFFO1FBQzFCLE9BQU8sRUFBVyxFQUFFO1FBQ3BCLFdBQVcsRUFBZSxFQUFFO1FBQzVCLE9BQU8sRUFBWSxFQUFFO1FBQ3JCLE9BQU8sRUFBRSxFQUFFO0tBRWQ7SUFDRCxNQUFNO1FBQU4saUJBWUM7UUFYRyxJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1QsT0FBTyxFQUFFLElBQUksa0JBQU8sRUFBRTtZQUN0QixXQUFXLEVBQUUsSUFBSSwwQkFBVyxFQUFFO1NBQ2pDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFBLE1BQU07WUFDM0MsS0FBSSxDQUFDLE9BQU8sQ0FBQztnQkFDVCxPQUFPLEVBQUUsTUFBTTtnQkFDZixZQUFZLEVBQUUsRUFBRTthQUNuQixDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNyQixDQUFDO0lBQ0QsU0FBUztRQUFULGlCQWNDO1FBYkcsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQUEsTUFBTTtZQUMxQyxLQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNULE9BQU8sRUFBRSxNQUFNO2dCQUNmLFlBQVksRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQUEsQ0FBQztvQkFDdEIsT0FBd0I7d0JBQ3BCLFFBQVEsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFD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QUNQLENBQUM7Q0FDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1d4QmluZEV2ZW50fSBmcm9tICcuLi8uLi8uLi8uLi91dGlscy90eXBlcy93eC1iaW5kLWV2ZW50JztcbmltcG9ydCB7SXRlbUFwaX0gZnJvbSAnLi4vLi4vLi4vLi4vYXBpcy9pdGVtLWFwaSc7XG5pbXBvcnQge1VwbG9hZEltYWdlSXRlbSwgVXBsb2FkSW1hZ2VJdGVtT2JqfSBmcm9tICcuLi8uLi8uLi8uLi91dGlscy90eXBlcy91cGxvYWQtaW1hZ2UtaXRlbSc7XG5pbXBvcnQge1NldHRpbmdzQXBpfSBmcm9tICcuLi8uLi8uLi8uLi9hcGlzL3NldHRpbmdzLWFwaSc7XG5pbXBvcnQge0Jhbm5lcn0gZnJvbSAnLi4vLi4vLi4vLi4vdXRpbHMvdHlwZXMvYmFubmVyJztcblxuUGFnZSh7XG4gICAgZGF0YToge1xuICAgICAgICBzd2lwZXJJbWFnZXM6IDxVcGxvYWRJbWFnZUl0ZW1bXT5bXSxcbiAgICAgICAgdXBsb2FkSW1hZ2VzOiA8c3RyaW5nW10+W10sXG4gICAgICAgIGl0ZW1BcGk6IDxJdGVtQXBpPnt9LFxuICAgICAgICBzZXR0aW5nc0FwaTogPFNldHRpbmdzQXBpPnt9LFxuICAgICAgICBiYW5uZXJzOiA8QmFubmVyW10+W10sXG4gICAgICAgIHVwVG9rZW46ICcnLFxuXG4gICAgfSxcbiAgICBvbkxvYWQoKSB7XG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICBpdGVtQXBpOiBuZXcgSXRlbUFwaSgpLFxuICAgICAgICAgICAgc2V0dGluZ3NBcGk6IG5ldyBTZXR0aW5nc0FwaSgpXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmRhdGEuc2V0dGluZ3NBcGkudXBsb2FkVG9rZW4oKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgICAgIHVwVG9rZW46IHJlc3VsdCxcbiAgICAgICAgICAgICAgICBzd2lwZXJJbWFnZXM6IFtdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZ2V0U3dpcGVyKCk7XG4gICAgfSxcbiAgICBnZXRTd2lwZXIoKSB7XG4gICAgICAgIHRoaXMuZGF0YS5zZXR0aW5nc0FwaS5nZXRCYW5uZXJzKCkudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgICAgICBiYW5uZXJzOiByZXN1bHQsXG4gICAgICAgICAgICAgICAgc3dpcGVySW1hZ2VzOiByZXN1bHQubWFwKGkgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gPFVwbG9hZEltYWdlSXRlbT57XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlTmFtZTogaS5pbWFnZVVybC5zcGxpdCgnLycpW2kuaW1hZ2VVcmwuc3BsaXQoJy8nKS5sZW5ndGggLSAxXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBQYXRoOiBpLmltYWdlVXJsLFxuICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBpbWFnZUFjdGlvbihlOiBXeEJpbmRFdmVudCkge1xuICAgICAgICB3eC5zaG93QWN0aW9uU2hlZXQoe1xuICAgICAgICAgICAgaXRlbUxpc3Q6IFsn5Yig6ZmkJ10sXG4gICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChyZXMudGFwSW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3dpcGVySW1hZ2VzID0gdGhpcy5kYXRhLnN3aXBlckltYWdlcztcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXBlckltYWdlcy5zcGxpY2UoZS5jdXJyZW50VGFyZ2V0LmRhdGFzZXQuaW1hZ2VJbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXBlckltYWdlczogc3dpcGVySW1hZ2VzXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgY2hvb3NlSW1hZ2UoKSB7XG4gICAgICAgIHd4LmNob29zZUltYWdlKHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB1cGxvYWRJbWFnZUl0ZW1PYmogPSBuZXcgVXBsb2FkSW1hZ2VJdGVtT2JqKHRoaXMuZGF0YS51cFRva2VuLCByZXMudGVtcEZpbGVQYXRoc1swXSwgJ2luZGV4X3N3aXBlcicsIChkKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgc3dpcGVySW1hZ2VzID0gdGhpcy5kYXRhLnN3aXBlckltYWdlcztcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXBlckltYWdlcy5mb3JFYWNoKGkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpLmZpbGVOYW1lID09PSBkLmZpbGVOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkucHJvZ3Jlc3MgPSBkLnByb2dyZXNzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLmNvbXBsZXRlZCA9IGQuY29tcGxldGVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLnN1Y2Nlc3MgPSBkLnN1Y2Nlc3M7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXBlckltYWdlczogc3dpcGVySW1hZ2VzXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgbGV0IHN3aXBlckltYWdlcyA9IHRoaXMuZGF0YS5zd2lwZXJJbWFnZXM7XG4gICAgICAgICAgICAgICAgc3dpcGVySW1hZ2VzLnB1c2godXBsb2FkSW1hZ2VJdGVtT2JqKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgICAgICAgICBzd2lwZXJJbWFnZXM6IHN3aXBlckltYWdlc1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHVwbG9hZEltYWdlSXRlbU9iai51cGxvYWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBzdWJtaXQoKSB7XG4gICAgICAgIGNvbnN0IGltYWdlcyA9IHRoaXMuZGF0YS5zd2lwZXJJbWFnZXMubWFwKGkgPT4gaS5maWxlTmFtZSk7XG4gICAgICAgIHRoaXMuZGF0YS5zZXR0aW5nc0FwaS51cGRhdGVCYW5uZXJzKGltYWdlcykudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAgICAgICAgICAgICAgIHRpdGxlOiAn5L+d5a2Y5oiQ5YqfJyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcbiJdfQ==