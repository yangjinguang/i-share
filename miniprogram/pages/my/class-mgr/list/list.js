"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var class_api_1 = require("../../../../apis/class-api");
var app = getApp();
Page({
    data: {
        profile: {},
        classApi: {},
        gradeId: 0,
        classList: []
    },
    onLoad: function (query) {
        this.setData({
            profile: app.globalData.profile,
            classApi: new class_api_1.ClassApi(),
            gradeId: query['gradeId'],
            gradeName: query['gradeName']
        });
    },
    onShow: function () {
        if (this.data.gradeId) {
            this.getClassList();
        }
    },
    getClassList: function () {
        var _this = this;
        this.data.classApi.classListByGradeId(this.data.gradeId).then(function (result) {
            _this.setData({
                classList: result
            });
        });
    },
    classCreate: function () {
        this.toCreateClass();
    },
    toCreateClass: function (classId) {
        var url = '/pages/my/class-mgr/create/create?t=class&gradeId=' + this.data.gradeId;
        if (classId) {
            url = url + '&classId=' + classId;
        }
        wx.navigateTo({
            url: url
        });
    },
    classAction: function (e) {
        var _this = this;
        var classId = e.currentTarget.dataset.classId;
        if (!classId) {
            return;
        }
        wx.showActionSheet({
            itemList: ['上移', '下移', '编辑', '删除'],
            success: function (res) {
                var _a, _b;
                switch (res.tapIndex) {
                    case 0:
                        var list = _this.data.classList.map(function (i) { return i.id; });
                        var index = list.indexOf(classId);
                        if (index > 0) {
                            _a = [list[index], list[index - 1]], list[index - 1] = _a[0], list[index] = _a[1];
                            _this.data.classApi.updateClassOrder(list).then(function () {
                                _this.getClassList();
                            });
                        }
                        break;
                    case 1:
                        var list2 = _this.data.classList.map(function (i) { return i.id; });
                        var index2 = list2.indexOf(classId);
                        if (index2 < list2.length - 1) {
                            _b = [list2[index2 + 1], list2[index2]], list2[index2] = _b[0], list2[index2 + 1] = _b[1];
                            _this.data.classApi.updateClassOrder(list2).then(function () {
                                _this.getClassList();
                            });
                        }
                        break;
                    case 2:
                        _this.toCreateClass(classId);
                        break;
                    case 3:
                        _this.data.classApi.delete(classId).then(function () {
                            _this.getClassList();
                        });
                        break;
                }
            }
        });
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImxpc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx3REFBb0Q7QUFLcEQsSUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFVLENBQUM7QUFFN0IsSUFBSSxDQUFDO0lBQ0QsSUFBSSxFQUFFO1FBQ0YsT0FBTyxFQUFRLEVBQUU7UUFDakIsUUFBUSxFQUFZLEVBQUU7UUFDdEIsT0FBTyxFQUFFLENBQUM7UUFDVixTQUFTLEVBQVcsRUFBRTtLQUN6QjtJQUNELE1BQU0sRUFBTixVQUFPLEtBQVU7UUFDYixJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1QsT0FBTyxFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsT0FBTztZQUMvQixRQUFRLEVBQUUsSUFBSSxvQkFBUSxFQUFFO1lBQ3hCLE9BQU8sRUFBRSxLQUFLLENBQUMsU0FBUyxDQUFDO1lBQ3pCLFNBQVMsRUFBRSxLQUFLLENBQUMsV0FBVyxDQUFDO1NBQ2hDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFDRCxNQUFNO1FBQ0YsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNuQixJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7U0FDdkI7SUFDTCxDQUFDO0lBQ0QsWUFBWTtRQUFaLGlCQU1DO1FBTEcsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQSxNQUFNO1lBQ2hFLEtBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQ1QsU0FBUyxFQUFFLE1BQU07YUFDcEIsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBQ0QsV0FBVztRQUNQLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBQ0QsYUFBYSxFQUFiLFVBQWMsT0FBZ0I7UUFDMUIsSUFBSSxHQUFHLEdBQUcsb0RBQW9ELEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDbkYsSUFBSSxPQUFPLEVBQUU7WUFDVCxHQUFHLEdBQUcsR0FBRyxHQUFHLFdBQVcsR0FBRyxPQUFPLENBQUM7U0FDckM7UUFDRCxFQUFFLENBQUMsVUFBVSxDQUFDO1lBQ1YsR0FBRyxFQUFFLEdBQUc7U0FDWCxDQUFDLENBQUM7SUFDUCxDQUFDO0lBQ0QsV0FBVyxFQUFYLFVBQVksQ0FBTTtRQUFsQixpQkF3Q0M7UUF2Q0csSUFBTSxPQUFPLEdBQUcsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDO1FBQ2hELElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDVixPQUFPO1NBQ1Y7UUFDRCxFQUFFLENBQUMsZUFBZSxDQUFDO1lBQ2YsUUFBUSxFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDO1lBQ2xDLE9BQU8sRUFBRSxVQUFDLEdBQUc7O2dCQUNULFFBQVEsR0FBRyxDQUFDLFFBQVEsRUFBRTtvQkFDbEIsS0FBSyxDQUFDO3dCQUNGLElBQUksSUFBSSxHQUFHLEtBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxFQUFFLEVBQUosQ0FBSSxDQUFDLENBQUM7d0JBQzlDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7d0JBQ2xDLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRTs0QkFDWCxtQ0FBK0QsRUFBOUQsdUJBQWUsRUFBRSxtQkFBVyxDQUFtQzs0QkFDaEUsS0FBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDO2dDQUMzQyxLQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7NEJBQ3hCLENBQUMsQ0FBQyxDQUFDO3lCQUNOO3dCQUNELE1BQU07b0JBQ1YsS0FBSyxDQUFDO3dCQUNGLElBQUksS0FBSyxHQUFHLEtBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxFQUFFLEVBQUosQ0FBSSxDQUFDLENBQUM7d0JBQy9DLElBQUksTUFBTSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7d0JBQ3BDLElBQUksTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFOzRCQUMzQix1Q0FBdUUsRUFBdEUscUJBQWEsRUFBRSx5QkFBaUIsQ0FBdUM7NEJBQ3hFLEtBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQztnQ0FDNUMsS0FBSSxDQUFDLFlBQVksRUFBRSxDQUFDOzRCQUN4QixDQUFDLENBQUMsQ0FBQzt5QkFDTjt3QkFDRCxNQUFNO29CQUNWLEtBQUssQ0FBQzt3QkFDRixLQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO3dCQUM1QixNQUFNO29CQUNWLEtBQUssQ0FBQzt3QkFDRixLQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDOzRCQUNwQyxLQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7d0JBQ3hCLENBQUMsQ0FBQyxDQUFDO3dCQUNILE1BQU07aUJBQ2I7WUFDTCxDQUFDO1NBQ0osQ0FBQyxDQUFDO0lBQ1AsQ0FBQztDQUVKLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q2xhc3NBcGl9IGZyb20gJy4uLy4uLy4uLy4uL2FwaXMvY2xhc3MtYXBpJztcbmltcG9ydCB7Q2xhc3N9IGZyb20gJy4uLy4uLy4uLy4uL3V0aWxzL3R5cGVzL2NsYXNzJztcbmltcG9ydCB7SU15QXBwfSBmcm9tICcuLi8uLi8uLi8uLi9hcHAnO1xuaW1wb3J0IHtVc2VyfSBmcm9tICcuLi8uLi8uLi8uLi91dGlscy90eXBlcy91c2VyJztcblxuY29uc3QgYXBwID0gZ2V0QXBwPElNeUFwcD4oKTtcblxuUGFnZSh7XG4gICAgZGF0YToge1xuICAgICAgICBwcm9maWxlOiA8VXNlcj57fSxcbiAgICAgICAgY2xhc3NBcGk6IDxDbGFzc0FwaT57fSxcbiAgICAgICAgZ3JhZGVJZDogMCxcbiAgICAgICAgY2xhc3NMaXN0OiA8Q2xhc3NbXT5bXVxuICAgIH0sXG4gICAgb25Mb2FkKHF1ZXJ5OiBhbnkpIHtcbiAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgIHByb2ZpbGU6IGFwcC5nbG9iYWxEYXRhLnByb2ZpbGUsXG4gICAgICAgICAgICBjbGFzc0FwaTogbmV3IENsYXNzQXBpKCksXG4gICAgICAgICAgICBncmFkZUlkOiBxdWVyeVsnZ3JhZGVJZCddLFxuICAgICAgICAgICAgZ3JhZGVOYW1lOiBxdWVyeVsnZ3JhZGVOYW1lJ11cbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBvblNob3coKSB7XG4gICAgICAgIGlmICh0aGlzLmRhdGEuZ3JhZGVJZCkge1xuICAgICAgICAgICAgdGhpcy5nZXRDbGFzc0xpc3QoKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgZ2V0Q2xhc3NMaXN0KCkge1xuICAgICAgICB0aGlzLmRhdGEuY2xhc3NBcGkuY2xhc3NMaXN0QnlHcmFkZUlkKHRoaXMuZGF0YS5ncmFkZUlkKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgICAgIGNsYXNzTGlzdDogcmVzdWx0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBjbGFzc0NyZWF0ZSgpIHtcbiAgICAgICAgdGhpcy50b0NyZWF0ZUNsYXNzKCk7XG4gICAgfSxcbiAgICB0b0NyZWF0ZUNsYXNzKGNsYXNzSWQ/OiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IHVybCA9ICcvcGFnZXMvbXkvY2xhc3MtbWdyL2NyZWF0ZS9jcmVhdGU/dD1jbGFzcyZncmFkZUlkPScgKyB0aGlzLmRhdGEuZ3JhZGVJZDtcbiAgICAgICAgaWYgKGNsYXNzSWQpIHtcbiAgICAgICAgICAgIHVybCA9IHVybCArICcmY2xhc3NJZD0nICsgY2xhc3NJZDtcbiAgICAgICAgfVxuICAgICAgICB3eC5uYXZpZ2F0ZVRvKHtcbiAgICAgICAgICAgIHVybDogdXJsXG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgY2xhc3NBY3Rpb24oZTogYW55KSB7XG4gICAgICAgIGNvbnN0IGNsYXNzSWQgPSBlLmN1cnJlbnRUYXJnZXQuZGF0YXNldC5jbGFzc0lkO1xuICAgICAgICBpZiAoIWNsYXNzSWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB3eC5zaG93QWN0aW9uU2hlZXQoe1xuICAgICAgICAgICAgaXRlbUxpc3Q6IFsn5LiK56e7JywgJ+S4i+enuycsICfnvJbovpEnLCAn5Yig6ZmkJ10sXG4gICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChyZXMudGFwSW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxpc3QgPSB0aGlzLmRhdGEuY2xhc3NMaXN0Lm1hcChpID0+IGkuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluZGV4ID0gbGlzdC5pbmRleE9mKGNsYXNzSWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtsaXN0W2luZGV4IC0gMV0sIGxpc3RbaW5kZXhdXSA9IFtsaXN0W2luZGV4XSwgbGlzdFtpbmRleCAtIDFdXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRhdGEuY2xhc3NBcGkudXBkYXRlQ2xhc3NPcmRlcihsaXN0KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDbGFzc0xpc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgbGlzdDIgPSB0aGlzLmRhdGEuY2xhc3NMaXN0Lm1hcChpID0+IGkuaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGluZGV4MiA9IGxpc3QyLmluZGV4T2YoY2xhc3NJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW5kZXgyIDwgbGlzdDIubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtsaXN0MltpbmRleDJdLCBsaXN0MltpbmRleDIgKyAxXV0gPSBbbGlzdDJbaW5kZXgyICsgMV0sIGxpc3QyW2luZGV4Ml1dO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5jbGFzc0FwaS51cGRhdGVDbGFzc09yZGVyKGxpc3QyKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDbGFzc0xpc3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnRvQ3JlYXRlQ2xhc3MoY2xhc3NJZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kYXRhLmNsYXNzQXBpLmRlbGV0ZShjbGFzc0lkKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldENsYXNzTGlzdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxufSk7XG4iXX0=