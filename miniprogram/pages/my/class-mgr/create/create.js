"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var class_api_1 = require("../../../../apis/class-api");
var app = getApp();
Page({
    data: {
        classApi: {},
        type: '',
        title: '',
        gradeId: 0,
        classId: 0,
        isNew: true,
        name: '',
        profile: {}
    },
    onLoad: function (query) {
        var type = query['t'];
        var gradeId = query['gradeId'];
        var classId = query['classId'];
        var title = '';
        var isNew = true;
        if (type === 'grade') {
            isNew = !gradeId;
            title = '年级名称';
        }
        else {
            title = '班级名称';
            isNew = !classId;
        }
        this.setData({
            classApi: new class_api_1.ClassApi(),
            profile: app.globalData.profile,
            type: type || '',
            title: title,
            gradeId: gradeId || '',
            classId: classId || '',
            isNew: isNew
        });
        if (!this.data.isNew) {
            if (type === 'grade') {
                this.getGrade(this.data.gradeId);
            }
            else {
                this.getClass(this.data.classId);
            }
        }
    },
    getGrade: function (gradeId) {
        var _this = this;
        this.data.classApi.getGrade(gradeId).then(function (result) {
            _this.setData({
                name: result.name
            });
        });
    },
    getClass: function (classId) {
        var _this = this;
        this.data.classApi.getClass(classId).then(function (result) {
            _this.setData({
                name: result.name
            });
        });
    },
    formSubmit: function (e) {
        console.log(e);
        if (this.data.type === 'grade') {
            var newGrade = {
                name: e.detail.value['name']
            };
            if (this.data.isNew) {
                console.log(newGrade);
                this.data.classApi.createGrade(newGrade).then(function () {
                    wx.navigateBack({
                        delta: 1
                    });
                });
            }
            else {
                this.data.classApi.updateGrade(this.data.gradeId, newGrade).then(function () {
                    wx.navigateBack({
                        delta: 1
                    });
                });
            }
        }
        else {
            var newClass = {
                gradeId: this.data.gradeId,
                name: e.detail.value['name']
            };
            if (this.data.isNew) {
                this.data.classApi.createClass(newClass).then(function () {
                    wx.navigateBack({
                        delta: 1
                    });
                });
            }
            else {
                this.data.classApi.updateClass(this.data.classId, newClass).then(function () {
                    wx.navigateBack({
                        delta: 1
                    });
                });
            }
        }
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY3JlYXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsd0RBQW9EO0FBTXBELElBQU0sR0FBRyxHQUFHLE1BQU0sRUFBVSxDQUFDO0FBRTdCLElBQUksQ0FBQztJQUNELElBQUksRUFBRTtRQUNGLFFBQVEsRUFBWSxFQUFFO1FBQ3RCLElBQUksRUFBRSxFQUFFO1FBQ1IsS0FBSyxFQUFFLEVBQUU7UUFDVCxPQUFPLEVBQUUsQ0FBQztRQUNWLE9BQU8sRUFBRSxDQUFDO1FBQ1YsS0FBSyxFQUFFLElBQUk7UUFDWCxJQUFJLEVBQUUsRUFBRTtRQUNSLE9BQU8sRUFBUSxFQUFFO0tBQ3BCO0lBQ0QsTUFBTSxZQUFDLEtBQVU7UUFDYixJQUFNLElBQUksR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDeEIsSUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2pDLElBQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNqQyxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDZixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxJQUFJLEtBQUssT0FBTyxFQUFFO1lBQ2xCLEtBQUssR0FBRyxDQUFDLE9BQU8sQ0FBQztZQUNqQixLQUFLLEdBQUcsTUFBTSxDQUFDO1NBQ2xCO2FBQU07WUFDSCxLQUFLLEdBQUcsTUFBTSxDQUFDO1lBQ2YsS0FBSyxHQUFHLENBQUMsT0FBTyxDQUFDO1NBQ3BCO1FBQ0QsSUFBSSxDQUFDLE9BQU8sQ0FBQztZQUNULFFBQVEsRUFBRSxJQUFJLG9CQUFRLEVBQUU7WUFDeEIsT0FBTyxFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsT0FBTztZQUMvQixJQUFJLEVBQUUsSUFBSSxJQUFJLEVBQUU7WUFDaEIsS0FBSyxFQUFFLEtBQUs7WUFDWixPQUFPLEVBQUUsT0FBTyxJQUFJLEVBQUU7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QUMsQ0FBQyxJQUFJLENBQUM7b0JBQzdELEVBQUUsQ0FBQyxZQUFZLENBQUM7d0JBQ1osS0FBSyxFQUFFLENBQUM7cUJBQ1gsQ0FBQyxDQUFDO2dCQUNQLENBQUMsQ0FBQyxDQUFDO2FBQ047U0FDSjtJQUNMLENBQUM7Q0FDSixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NsYXNzQXBpfSBmcm9tICcuLi8uLi8uLi8uLi9hcGlzL2NsYXNzLWFwaSc7XG5pbXBvcnQge0dyYWRlfSBmcm9tICcuLi8uLi8uLi8uLi91dGlscy90eXBlcy9ncmFkZSc7XG5pbXBvcnQge0NsYXNzfSBmcm9tICcuLi8uLi8uLi8uLi91dGlscy90eXBlcy9jbGFzcyc7XG5pbXBvcnQge0lNeUFwcH0gZnJvbSAnLi4vLi4vLi4vLi4vYXBwJztcbmltcG9ydCB7VXNlcn0gZnJvbSAnLi4vLi4vLi4vLi4vdXRpbHMvdHlwZXMvdXNlcic7XG5cbmNvbnN0IGFwcCA9IGdldEFwcDxJTXlBcHA+KCk7XG5cblBhZ2Uoe1xuICAgIGRhdGE6IHtcbiAgICAgICAgY2xhc3NBcGk6IDxDbGFzc0FwaT57fSxcbiAgICAgICAgdHlwZTogJycsXG4gICAgICAgIHRpdGxlOiAnJyxcbiAgICAgICAgZ3JhZGVJZDogMCxcbiAgICAgICAgY2xhc3NJZDogMCxcbiAgICAgICAgaXNOZXc6IHRydWUsXG4gICAgICAgIG5hbWU6ICcnLFxuICAgICAgICBwcm9maWxlOiA8VXNlcj57fVxuICAgIH0sXG4gICAgb25Mb2FkKHF1ZXJ5OiBhbnkpIHtcbiAgICAgICAgY29uc3QgdHlwZSA9IHF1ZXJ5Wyd0J107XG4gICAgICAgIGNvbnN0IGdyYWRlSWQgPSBxdWVyeVsnZ3JhZGVJZCddO1xuICAgICAgICBjb25zdCBjbGFzc0lkID0gcXVlcnlbJ2NsYXNzSWQnXTtcbiAgICAgICAgbGV0IHRpdGxlID0gJyc7XG4gICAgICAgIGxldCBpc05ldyA9IHRydWU7XG4gICAgICAgIGlmICh0eXBlID09PSAnZ3JhZGUnKSB7XG4gICAgICAgICAgICBpc05ldyA9ICFncmFkZUlkO1xuICAgICAgICAgICAgdGl0bGUgPSAn5bm057qn5ZCN56ewJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRpdGxlID0gJ+ePree6p+WQjeensCc7XG4gICAgICAgICAgICBpc05ldyA9ICFjbGFzc0lkO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICAgICAgICBjbGFzc0FwaTogbmV3IENsYXNzQXBpKCksXG4gICAgICAgICAgICBwcm9maWxlOiBhcHAuZ2xvYmFsRGF0YS5wcm9maWxlLFxuICAgICAgICAgICAgdHlwZTogdHlwZSB8fCAnJyxcbiAgICAgICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgICAgIGdyYWRlSWQ6IGdyYWRlSWQgfHwgJycsXG4gICAgICAgICAgICBjbGFzc0lkOiBjbGFzc0lkIHx8ICcnLFxuICAgICAgICAgICAgaXNOZXc6IGlzTmV3XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIXRoaXMuZGF0YS5pc05ldykge1xuICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdncmFkZScpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdldEdyYWRlKHRoaXMuZGF0YS5ncmFkZUlkKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5nZXRDbGFzcyh0aGlzLmRhdGEuY2xhc3NJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGdldEdyYWRlKGdyYWRlSWQ6IG51bWJlcikge1xuICAgICAgICB0aGlzLmRhdGEuY2xhc3NBcGkuZ2V0R3JhZGUoZ3JhZGVJZCkudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgICAgICAgICBuYW1lOiByZXN1bHQubmFtZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgZ2V0Q2xhc3MoY2xhc3NJZDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMuZGF0YS5jbGFzc0FwaS5nZXRDbGFzcyhjbGFzc0lkKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xuICAgICAgICAgICAgICAgIG5hbWU6IHJlc3VsdC5uYW1lXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBmb3JtU3VibWl0KGU6IGFueSkge1xuICAgICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgICAgaWYgKHRoaXMuZGF0YS50eXBlID09PSAnZ3JhZGUnKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdHcmFkZSA9IDxHcmFkZT57XG4gICAgICAgICAgICAgICAgbmFtZTogZS5kZXRhaWwudmFsdWVbJ25hbWUnXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmICh0aGlzLmRhdGEuaXNOZXcpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhuZXdHcmFkZSk7XG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhLmNsYXNzQXBpLmNyZWF0ZUdyYWRlKG5ld0dyYWRlKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgd3gubmF2aWdhdGVCYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbHRhOiAxXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEuY2xhc3NBcGkudXBkYXRlR3JhZGUodGhpcy5kYXRhLmdyYWRlSWQsIG5ld0dyYWRlKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgd3gubmF2aWdhdGVCYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbHRhOiAxXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgbmV3Q2xhc3MgPSA8Q2xhc3M+e1xuICAgICAgICAgICAgICAgIGdyYWRlSWQ6IHRoaXMuZGF0YS5ncmFkZUlkLFxuICAgICAgICAgICAgICAgIG5hbWU6IGUuZGV0YWlsLnZhbHVlWyduYW1lJ11cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAodGhpcy5kYXRhLmlzTmV3KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhLmNsYXNzQXBpLmNyZWF0ZUNsYXNzKG5ld0NsYXNzKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgd3gubmF2aWdhdGVCYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbHRhOiAxXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEuY2xhc3NBcGkudXBkYXRlQ2xhc3ModGhpcy5kYXRhLmNsYXNzSWQsIG5ld0NsYXNzKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgd3gubmF2aWdhdGVCYWNrKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlbHRhOiAxXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSk7XG4iXX0=