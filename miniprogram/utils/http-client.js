"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var HttpClient = (function () {
    function HttpClient() {
        this.header = {
            'content-type': 'application/json'
        };
    }
    HttpClient.prototype.urlGen = function (url, query) {
        var queryArr = [];
        Object.keys(query).forEach(function (key) {
            queryArr.push(key + '=' + query[key]);
        });
        if (queryArr.length > 0) {
            return url + "?" + queryArr.join('&');
        }
        else {
            return url;
        }
    };
    HttpClient.prototype.headerGen = function (header) {
        var token = wx.getStorageSync('accessToken');
        if (token) {
            this.header['Authorization'] = token;
        }
        if (header) {
            return Object.assign(this.header, header);
        }
        return this.header;
    };
    HttpClient.prototype.errorHandler = function (res) {
        var apiRes = res.data;
        switch (res.statusCode) {
            case 401:
                wx.removeStorageSync('accessToken');
                wx.switchTab({
                    url: '/pages/my/my'
                });
                break;
            case 400:
            case 500:
                wx.showToast({
                    title: apiRes.message || '未知错误',
                    icon: 'none',
                    duration: 1000
                });
                break;
            default:
                break;
        }
    };
    HttpClient.prototype.get = function (url, query, header) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            wx.request({
                url: query ? _this.urlGen(url, query) : url,
                method: 'GET',
                header: _this.headerGen(header),
                success: function (res) {
                    _this.errorHandler(res);
                    var resData = res.data;
                    if (resData.code != 200) {
                        reject(resData);
                    }
                    else {
                        resolve(resData.data);
                    }
                },
                fail: function (err) {
                    reject(err);
                }
            });
        });
    };
    HttpClient.prototype.post = function (url, data, header) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            wx.request({
                url: url,
                method: 'POST',
                header: _this.headerGen(header),
                data: data,
                success: function (res) {
                    _this.errorHandler(res);
                    var resData = res.data;
                    if (resData.code != 200) {
                        reject(resData);
                    }
                    else {
                        resolve(resData.data);
                    }
                },
                fail: function (err) {
                    reject(err);
                }
            });
        });
    };
    HttpClient.prototype.put = function (url, data, header) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            wx.request({
                url: url,
                method: 'PUT',
                header: _this.headerGen(header),
                data: data,
                success: function (res) {
                    _this.errorHandler(res);
                    var resData = res.data;
                    if (resData.code != 200) {
                        reject(resData);
                    }
                    else {
                        resolve(resData.data);
                    }
                },
                fail: function (err) {
                    reject(err);
                }
            });
        });
    };
    HttpClient.prototype.delete = function (url, query, header) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            wx.request({
                url: query ? _this.urlGen(url, query) : url,
                method: 'DELETE',
                header: _this.headerGen(header),
                success: function (res) {
                    _this.errorHandler(res);
                    var resData = res.data;
                    if (resData.code != 200) {
                        reject(resData);
                    }
                    else {
                        resolve(resData.data);
                    }
                },
                fail: function (err) {
                    reject(err);
                }
            });
        });
    };
    return HttpClient;
}());
exports.HttpClient = HttpClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaHR0cC1jbGllbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJodHRwLWNsaWVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUtBO0lBR0k7UUFDSSxJQUFJLENBQUMsTUFBTSxHQUFHO1lBQ1YsY0FBYyxFQUFFLGtCQUFrQjtTQUNyQyxDQUFDO0lBQ04sQ0FBQztJQUVPLDJCQUFNLEdBQWQsVUFBZSxHQUFXLEVBQUUsS0FBZ0M7UUFDeEQsSUFBSSxRQUFRLEdBQWEsRUFBRSxDQUFDO1FBQzVCLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQUEsR0FBRztZQUMxQixRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLEdBQUcsS0FBSyxDQUFDLEdBQW1CLENBQUMsQ0FBQyxDQUFDO1FBQzFELENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNyQixPQUFVLEdBQUcsU0FBSSxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBRyxDQUFDO1NBQ3pDO2FBQU07WUFDSCxPQUFPLEdBQUcsQ0FBQztTQUNkO0lBQ0wsQ0FBQztJQUVPLDhCQUFTLEdBQWpCLFVBQWtCLE1BQWtDO1FBQ2hELElBQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQyxjQUFjLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDL0MsSUFBSSxLQUFLLEVBQUU7WUFDUCxJQUFJLENBQUMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxHQUFHLEtBQUssQ0FBQztTQUN4QztRQUNELElBQUksTUFBTSxFQUFFO1lBQ1IsT0FBYSxNQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7U0FDcEQ7UUFDRCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDdkIsQ0FBQztJQUVPLGlDQUFZLEdBQXBCLFVBQXFCLEdBQWlDO1FBQ2xELElBQU0sTUFBTSxHQUFHLEdB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SSxPQUFPLENBQUMsSUFBSSxJQUFJLEdBQUcsRUFBRTt3QkFDckIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO3FCQUNuQjt5QkFBTTt3QkFDSCxPQUFPLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO3FCQUN6QjtnQkFDTCxDQUFDO2dCQUNELElBQUksRUFBRSxVQUFDLEdBQUc7b0JBQ04sTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNoQixDQUFDO2FBQ0osQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBQ0wsaUJBQUM7QUFBRCxDQUFDLEFBaEpELElBZ0pDO0FBaEpZLGdDQUFVIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtBcGlSZXNwb25zZX0gZnJvbSAnLi90eXBlcy9hcGktcmVzcG9uc2UnO1xuaW1wb3J0IFJlcXVlc3RTdWNjZXNzQ2FsbGJhY2tSZXN1bHQgPSBXZWNoYXRNaW5pcHJvZ3JhbS5SZXF1ZXN0U3VjY2Vzc0NhbGxiYWNrUmVzdWx0O1xuXG4vLyBjb25zdCBhcHAgPSBnZXRBcHA8SU15QXBwPigpO1xuXG5leHBvcnQgY2xhc3MgSHR0cENsaWVudCB7XG4gICAgcHJpdmF0ZSBoZWFkZXI6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH07XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5oZWFkZXIgPSB7XG4gICAgICAgICAgICAnY29udGVudC10eXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nXG4gICAgICAgIH07XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cmxHZW4odXJsOiBzdHJpbmcsIHF1ZXJ5OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9KTogc3RyaW5nIHtcbiAgICAgICAgbGV0IHF1ZXJ5QXJyOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgICBPYmplY3Qua2V5cyhxdWVyeSkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgICAgICAgcXVlcnlBcnIucHVzaChrZXkgKyAnPScgKyBxdWVyeVtrZXkgYXMga2V5b2Ygb2JqZWN0XSk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAocXVlcnlBcnIubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGAke3VybH0/JHtxdWVyeUFyci5qb2luKCcmJyl9YDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB1cmw7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGhlYWRlckdlbihoZWFkZXI/OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9KSB7XG4gICAgICAgIGNvbnN0IHRva2VuID0gd3guZ2V0U3RvcmFnZVN5bmMoJ2FjY2Vzc1Rva2VuJyk7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgdGhpcy5oZWFkZXJbJ0F1dGhvcml6YXRpb24nXSA9IHRva2VuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoZWFkZXIpIHtcbiAgICAgICAgICAgIHJldHVybiAoPGFueT5PYmplY3QpLmFzc2lnbih0aGlzLmhlYWRlciwgaGVhZGVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5oZWFkZXI7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBlcnJvckhhbmRsZXIocmVzOiBSZXF1ZXN0U3VjY2Vzc0NhbGxiYWNrUmVzdWx0KSB7XG4gICAgICAgIGNvbnN0IGFwaVJlcyA9IHJlcy5kYXRhIGFzIEFwaVJlc3BvbnNlO1xuICAgICAgICBzd2l0Y2ggKHJlcy5zdGF0dXNDb2RlKSB7XG4gICAgICAgICAgICBjYXNlIDQwMTpcbiAgICAgICAgICAgICAgICB3eC5yZW1vdmVTdG9yYWdlU3luYygnYWNjZXNzVG9rZW4nKTtcbiAgICAgICAgICAgICAgICB3eC5zd2l0Y2hUYWIoe1xuICAgICAgICAgICAgICAgICAgICB1cmw6ICcvcGFnZXMvbXkvbXknXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDQwMDpcbiAgICAgICAgICAgIGNhc2UgNTAwOlxuICAgICAgICAgICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBhcGlSZXMubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJyxcbiAgICAgICAgICAgICAgICAgICAgaWNvbjogJ25vbmUnLFxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTAwMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcblxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIGdldCh1cmw6IHN0cmluZywgcXVlcnk/OiB7IFtrZXk6IHN0cmluZ106IGFueSB9LCBoZWFkZXI/OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9KTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHd4LnJlcXVlc3Qoe1xuICAgICAgICAgICAgICAgIHVybDogcXVlcnkgPyB0aGlzLnVybEdlbih1cmwsIHF1ZXJ5KSA6IHVybCxcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgIGhlYWRlcjogdGhpcy5oZWFkZXJHZW4oaGVhZGVyKSxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JIYW5kbGVyKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc0RhdGEgPSByZXMuZGF0YSBhcyBBcGlSZXNwb25zZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc0RhdGEuY29kZSAhPSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzRGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZmFpbDogKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIHBvc3QodXJsOiBzdHJpbmcsIGRhdGE/OiBhbnksIGhlYWRlcj86IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0pOiBQcm9taXNlPGFueT4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgd3gucmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICAgICAgaGVhZGVyOiB0aGlzLmhlYWRlckdlbihoZWFkZXIpLFxuICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsXG4gICAgICAgICAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVycm9ySGFuZGxlcihyZXMpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNEYXRhID0gcmVzLmRhdGEgYXMgQXBpUmVzcG9uc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNEYXRhLmNvZGUgIT0gMjAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHJlc0RhdGEuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZhaWw6IChlcnIpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHB1YmxpYyBwdXQodXJsOiBzdHJpbmcsIGRhdGE/OiBhbnksIGhlYWRlcj86IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0pOiBQcm9taXNlPGFueT4ge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgd3gucmVxdWVzdCh7XG4gICAgICAgICAgICAgICAgdXJsOiB1cmwsXG4gICAgICAgICAgICAgICAgbWV0aG9kOiAnUFVUJyxcbiAgICAgICAgICAgICAgICBoZWFkZXI6IHRoaXMuaGVhZGVyR2VuKGhlYWRlciksXG4gICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JIYW5kbGVyKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc0RhdGEgPSByZXMuZGF0YSBhcyBBcGlSZXNwb25zZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc0RhdGEuY29kZSAhPSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzRGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZmFpbDogKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHVibGljIGRlbGV0ZSh1cmw6IHN0cmluZywgcXVlcnk/OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9LCBoZWFkZXI/OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9KTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHd4LnJlcXVlc3Qoe1xuICAgICAgICAgICAgICAgIHVybDogcXVlcnkgPyB0aGlzLnVybEdlbih1cmwsIHF1ZXJ5KSA6IHVybCxcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdERUxFVEUnLFxuICAgICAgICAgICAgICAgIGhlYWRlcjogdGhpcy5oZWFkZXJHZW4oaGVhZGVyKSxcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZXJyb3JIYW5kbGVyKHJlcyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc0RhdGEgPSByZXMuZGF0YSBhcyBBcGlSZXNwb25zZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc0RhdGEuY29kZSAhPSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUocmVzRGF0YS5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZmFpbDogKGVycikgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIl19