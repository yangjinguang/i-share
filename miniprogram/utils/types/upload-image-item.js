"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var file_upload_1 = require("../file-upload");
var UploadImageItemObj = (function () {
    function UploadImageItemObj(upToken, path, fileNamePrefix, onChange) {
        this.upToken = upToken;
        this.tempPath = path;
        var filePathSplit = this.tempPath.split('.');
        var suffix = filePathSplit[filePathSplit.length - 1];
        this.fileName = fileNamePrefix + "_" + Math.random().toString(36).substr(2) + "_" + new Date().getTime() + "." + suffix;
        this.progress = 0;
        this.success = false;
        this.completed = false;
        if (onChange) {
            this.onChange = onChange;
        }
    }
    UploadImageItemObj.prototype.upload = function () {
        var _this = this;
        var uploadTask = file_upload_1.qiniuFileUpload(this.tempPath, this.fileName, this.upToken, function () {
            _this.completed = true;
            _this.success = true;
            if (_this.onChange) {
                _this.onChange(_this);
            }
        }, function () {
            _this.completed = true;
            _this.success = false;
            if (_this.onChange) {
                _this.onChange(_this);
            }
        });
        uploadTask.onProgressUpdate(function (res) {
            _this.progress = res.progress;
            if (_this.onChange) {
                _this.onChange(_this);
            }
        });
    };
    ;
    return UploadImageItemObj;
}());
exports.UploadImageItemObj = UploadImageItemObj;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkLWltYWdlLWl0ZW0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJ1cGxvYWQtaW1hZ2UtaXRlbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDhDQUErQztBQVkvQztJQVNJLDRCQUFZLE9BQWUsRUFBRSxJQUFZLEVBQUUsY0FBc0IsRUFBRSxRQUFnRDtRQUMvRyxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztRQUNyQixJQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMvQyxJQUFNLE1BQU0sR0FBRyxhQUFhLENBQUMsYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUN2RCxJQUFJLENBQUMsUUFBUSxHQUFNLGNBQWMsU0FBSSxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsU0FBSSxJQUFJLElBQUksRUFBRSxDQUFDLE9BQU8sRUFBRSxTQUFJLE1BQVEsQ0FBQztRQUM5RyxJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQztRQUNsQixJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztRQUNyQixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN2QixJQUFJLFFBQVEsRUFBRTtZQUNWLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO1NBQzVCO0lBQ0wsQ0FBQztJQUVELG1DQUFNLEdBQU47UUFBQSxpQkFvQkM7UUFuQkcsSUFBTSxVQUFVLEdBQUcsNkJBQWUsQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUMzRSxLQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztZQUN0QixLQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztZQUNwQixJQUFJLEtBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQ2YsS0FBSSxDQUFDLFFBQVEsQ0FBQyxLQUFJLENBQUMsQ0FBQzthQUN2QjtRQUNMLENBQUMsRUFBRTtZQUNDLEtBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1lBQ3RCLEtBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO1lBQ3JCLElBQUksS0FBSSxDQUFDLFFBQVEsRUFBRTtnQkFDZixLQUFJLENBQUMsUUFBUSxDQUFDLEtBQUksQ0FBQyxDQUFDO2FBQ3ZCO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDSCxVQUFVLENBQUMsZ0JBQWdCLENBQUMsVUFBQSxHQUFHO1lBQzNCLEtBQUksQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQztZQUM3QixJQUFJLEtBQUksQ0FBQyxRQUFRLEVBQUU7Z0JBQ2YsS0FBSSxDQUFDLFFBQVEsQ0FBQyxLQUFJLENBQUMsQ0FBQzthQUN2QjtRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUFBLENBQUM7SUFDTix5QkFBQztBQUFELENBQUMsQUE1Q0QsSUE0Q0M7QUE1Q1ksZ0RBQWtCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtxaW5pdUZpbGVVcGxvYWR9IGZyb20gJy4uL2ZpbGUtdXBsb2FkJztcblxuZXhwb3J0IGludGVyZmFjZSBVcGxvYWRJbWFnZUl0ZW0ge1xuICAgIHRlbXBQYXRoOiBzdHJpbmc7XG4gICAgZmlsZU5hbWU6IHN0cmluZztcbiAgICBwcm9ncmVzczogbnVtYmVyO1xuICAgIGNvbXBsZXRlZDogYm9vbGVhbjtcbiAgICBzdWNjZXNzOiBib29sZWFuO1xuXG4gICAgdXBsb2FkOiAoKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgY2xhc3MgVXBsb2FkSW1hZ2VJdGVtT2JqIGltcGxlbWVudHMgVXBsb2FkSW1hZ2VJdGVtIHtcbiAgICBwdWJsaWMgY29tcGxldGVkOiBib29sZWFuO1xuICAgIHB1YmxpYyBmaWxlTmFtZTogc3RyaW5nO1xuICAgIHB1YmxpYyBwcm9ncmVzczogbnVtYmVyO1xuICAgIHB1YmxpYyBzdWNjZXNzOiBib29sZWFuO1xuICAgIHB1YmxpYyB0ZW1wUGF0aDogc3RyaW5nO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgdXBUb2tlbjogc3RyaW5nO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgb25DaGFuZ2U/OiAocmVzdWx0PzogVXBsb2FkSW1hZ2VJdGVtT2JqKSA9PiB2b2lkO1xuXG4gICAgY29uc3RydWN0b3IodXBUb2tlbjogc3RyaW5nLCBwYXRoOiBzdHJpbmcsIGZpbGVOYW1lUHJlZml4OiBzdHJpbmcsIG9uQ2hhbmdlPzogKHJlc3VsdD86IFVwbG9hZEltYWdlSXRlbU9iaikgPT4gdm9pZCkge1xuICAgICAgICB0aGlzLnVwVG9rZW4gPSB1cFRva2VuO1xuICAgICAgICB0aGlzLnRlbXBQYXRoID0gcGF0aDtcbiAgICAgICAgY29uc3QgZmlsZVBhdGhTcGxpdCA9IHRoaXMudGVtcFBhdGguc3BsaXQoJy4nKTtcbiAgICAgICAgY29uc3Qgc3VmZml4ID0gZmlsZVBhdGhTcGxpdFtmaWxlUGF0aFNwbGl0Lmxlbmd0aCAtIDFdO1xuICAgICAgICB0aGlzLmZpbGVOYW1lID0gYCR7ZmlsZU5hbWVQcmVmaXh9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIpfV8ke25ldyBEYXRlKCkuZ2V0VGltZSgpfS4ke3N1ZmZpeH1gO1xuICAgICAgICB0aGlzLnByb2dyZXNzID0gMDtcbiAgICAgICAgdGhpcy5zdWNjZXNzID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY29tcGxldGVkID0gZmFsc2U7XG4gICAgICAgIGlmIChvbkNoYW5nZSkge1xuICAgICAgICAgICAgdGhpcy5vbkNoYW5nZSA9IG9uQ2hhbmdlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdXBsb2FkKCkge1xuICAgICAgICBjb25zdCB1cGxvYWRUYXNrID0gcWluaXVGaWxlVXBsb2FkKHRoaXMudGVtcFBhdGgsIHRoaXMuZmlsZU5hbWUsIHRoaXMudXBUb2tlbiwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5zdWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmICh0aGlzLm9uQ2hhbmdlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkNoYW5nZSh0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5jb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5zdWNjZXNzID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy5vbkNoYW5nZSkge1xuICAgICAgICAgICAgICAgIHRoaXMub25DaGFuZ2UodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB1cGxvYWRUYXNrLm9uUHJvZ3Jlc3NVcGRhdGUocmVzID0+IHtcbiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3MgPSByZXMucHJvZ3Jlc3M7XG4gICAgICAgICAgICBpZiAodGhpcy5vbkNoYW5nZSkge1xuICAgICAgICAgICAgICAgIHRoaXMub25DaGFuZ2UodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG59XG4iXX0=